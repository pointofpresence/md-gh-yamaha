# Yamaha PSR goodies
<!-- copyright: SeeJay & ReSampled -->
# Школа продвинутого пользователя Yamaha PSR
## Урок №1
Предполагается, что Вы знакомы с основными функциями своего инструмента, знаете, что МИДИ файл состоит из треков. Настройки для Voice и для Voice Effect каждого трека Вы можете увидеть и покрутить их в Song Микшере. Подробно все Миди сообщения (Midi Event) в каждом Song треке Вы умеете просматривать и редактировать (не все!) в «микроскопе» с помощью Song Creator.
Примечание: на Вашем инструменте, пути доступа до конечного параметра выводимого на дисплей, могут отличаться от приведенного в тексте.
1. Включите свой PSR. На Main дисплее нажмите/Song/вкладка Preset/кнопки 8 вверх-вниз пока не появится Song+Preset+Style/нажмите Style/Выберите и загрузите Пресетный Song c демонстрацией звучания любого встроенного стиля// в секции [SONG] нажмите кнопку [Start].
2. Послушайте и определите каким стилем звучит эта Demo. Это должно быть как то привязано к его названию.
3. Остановите воспроизведение.
4. Зайдите в /Song Creator/ вкладка [1-16]/ (убедитесь, что вы действительно открыли тот Song, что только что слушали) и попытайтесь среди 16 треков этого Демо Сонга (Кнопка F <CH>) найти треки, в которых записаны партии звучавшего только что стиля (т.е. увидеть запись Midi Event) Именно стиля!!! Что бы не бегать по пустым трекам зайдите сразу на CH №10 там обычно должны быть записаны барабаны.
Есть ? ……
Но ведь играли!!!!
Да и Баса, который в стиле обычно на CH 11 дорожке, то же не видно ?!!
5. Если Вы сами, следуя инструкциям в Мануале, уже создавали на этом инструменте свой Song - файл с использованием Style, – загрузите его и откройте в Song Creator.(Если еще не делали этого – самое время попробовать). Посмотрите информацию на дорожках [CH10 – CH16]. …. Все треки стиля на месте ? !!
- Что не сходится?
- Yamaha учит делать одним способом, а сама сделала по другому !?
6. Еще раз проделайте п.п.1 и 2 с тем же первым загруженным пресетным Style Demo.
7. Не выключайте, пусть играет, попробуйте на ходу кнопками включить другой стиль….
О-о-о-п-п-ааа! Ту же Demo тему, записанную в стиле
< FunkyFusion > теперь играют в стиле< BossaNowa.> Нажмите STOP и опять на START. Song продолжается только теперь уже в стиле < BossaNowa.>.!? Не бойтесь, с файлом ничего не произошло! Встроенные Демо обычно защищены от редактирования и копирования. Если Вы опять посмотрите на его содержимое в Song Creator - ничего не поменялось, хотя (временно!!!) играл уже другой стиль?!
Это МИДИ файл с треками- невидимками !? Хотя если поискать, то можно обнаружить следы того кто их исполняет.
Вопрос: Вы сможете сказать – кто играл и где собственно запись? А в том, что это запись и сделала его Yamaha, сомневаться не приходится и больше того, Вы никогда не сможете ее (запись) в оригинальном виде скопировать или удалить из инструмента, или найти в интернете. Лично я ни разу ни чего подобного не встречал! (Не путать с самодельными «достаточно условными копиями» Style-Демо файлов, таких в Интернете предостаточно. Там точно Вы найдете все треки.)
Такой способ записи не описан ни в одном руководстве по PSR. Но Yamaha его использует. Я, с некоторых пор, то же! Вы то же сможете. Хотите попробовать?
При записи собственных аранжировок он здорово помогает. (Об этом-позже).
## Урок 1. Об этом нигде не пишут, но Ваша Yamaha это умеет!
Тема: Управление PSR инструментом с помощью MIDI сообщений.
Вы уже давно (с 80гг) могли слышать о МИДИ и большинство из Вас пользуется МИДИ файлами для записи и воспроизведения музыки, исполняемой на железных или софт инструментах, поддерживающих МИДИ стандарт. Для желающих, подробнее ознакомиться и/или освежить общие знания о МИДИ настоятельно рекомендую прекрасные [статьи нашего земляка Евгения Музыченко](https://www.ixbt.com/multimedia/mididescrib.html#q1) 
Здесь мы поговорим не о тревиальной записи нот муз партитур в МИДИ треках, а о том, как с помощью специальных МИДИ команд, передаваемых по МИДИ и/или записанных в МИДИ файл, управлять общей работой PSR инструмента. 
Рассматриваемые (в этой школе), Yamaha инструменты имеют много расширенных функций, выходящих за пределы обычного комплекта звукового модуля с клавиатурой: это в первую очередь Авто аккомпанемент, Мульти Пад (MP), Автоматическая гармонизация (добавление аккордовых нот) одноголосой партитуры, исполняемой на клавиатуре и т.д. Это выходит за рамки стандартных функций, управление которыми с помощью МИДИ сообщений регламентируется стандартами GM и GM2. Но полноценно управлять этим через МИДИ можно, с помощью специальных команд.
Стандарты GM, GM2, предусматривают наличие и определяют формат построения таких команд. Ямаховское расширение XG описывает многие из них, хотя далеко не о всех полезных, нужных и широко используемых самим производителем МИДИ командах дается публичная информация. Эти команды, или правильнее МИДИ сообщения о управляющих событиях, пишутся в формате эксклюзивных «SysEx events» и/или Фиктивных событий « Meta events». Далее будем говорить в основном о них, но давайте по порядку…
1. У Вас есть МИДИ файл с записью песни. Вы загружаете его в Миди-плеер инструмента, нажимаете кнопку START и …..все сразу заиграло! Можете что-то отключить или подстроить баланс партий (если в инструменте есть что то типа Balans Mixer и/или SONG Mixer), можно доигрывать «поверх» предварительно выбрав нужные Voices. Все замечательно! Но для этого Вам не нужен PSR или Tyros с их секцией Авто аккомпанемента и прочими наворотами. Это не наш случай!
2. Исполнитель подошел к инструменту: вкл /выбрал стиль/выбрал стартовую секцию стиля/ задал темп /выбрал Voices R1,R2,R3,L/ задал громкости для них/ добавил или убрал эффекты /установил баланс между стилем, клавиатурой, MP/ …. Все подготовлено к Старту или Синхро – старту. Нажат первый аккорд на клавиатуре в секции авто аккомпанемента, сработал Синхро-старт - началась музыка. Играем «в живую с Авто аккомпанементом». В нужном такте меняем аккорд, переключаем секции авто аккомпанемента, переключаем Voices в правой руке, пошла жара ….
Это далеко не полный перечень обязательных событий, которые происходят каждый раз прежде чем инструмент начнет звучать в режиме работы с Авто аккомпанементом и конечно «управленческие события» постоянно продолжают происходить в процессе игры.
Все перечисленные выше в п.2 (и не только эти) события ( а значит и команды) управления инструментом, можно «создавать руками» а можно записать в МИДИ файл в виде SysEx и/или Meta events. При воспроизведении такого МИДИ файла, секция Авто аккомпанемента в Вашем инструменте сама будет играть по записанной аккордовой схеме, сама в нужном месте будет делать все необходимые переключения (моргать лампочками!!!). Вам не нужно будет отвлекаться на управление Авто аккомпанементом. В такой файл, где стиль играет без участия исполнителя, по идеально точно и правильно прописанным командам, можно обычными способами дополнительно дописать треки, сыгранные вручную и поверх этого (если хватает полифонии !!!) играть "в живую".
Если у Вас PSR или Tyros, то Вы точно включали и слышали файлы, записанные таким способом - они лежат в инструменте, среди заводских пресетных демо Songs, демонстрирующих звучание встроенных Стилей. В названиях таких файлов обычно присутствует название Стиля, который там играет - стиль именно играет в живую!!! а не записан.
Копий таких "оригинальных" файлов нет в интернете (по крайней мере я не встречал). Вы можете (в Song Creator) просмотреть и по-треково сравнить содержимое такого файла с содержанием обычного (без стиля) Demo SMF. Что бы быстрее увидеть разницу - сравните содержание треков №10 (ударные) у обеих пресетных файлов Demo Songs ...
О-п-п-п-а-а-а!? Оказывается, сравнивать не с чем! В "заводском" Стиль-Demo MIDI файле партия CH10, где по умолчанию пишутся барабаны, пустая!!! Но ведь ударные звучали!? ( Не путать с самодельными «копиями Стиль-Демо файлов», их полно в интернете, там Вы точно найдете записи всех треков стиля. Обычно это треки 9-16. Но это не наш случай!).
Возможно, Вы не замечали, но посмотрите внимательнее, при воспроизведении записанного таким «не документированным» способом пресетного (заводского) файла, демонстрирующего звучание и работу стиля, секция Авто аккомпанемента ведет себя так, будто на инструменте играют «в живую»: переключаются варианты стиля MAIN A/ MAIN C / ENDING/ на дисплее высвечиваются и меняются Аккорды, которые «нажимает исполнитель - невидимка». 
Кроме того, у инструмента появляются неожиданные новые возможности :
1. Во время воспроизведения такого файла можно кнопками поменять стиль (и/или) секцию стиля и зазвучит аранжировка в новом стиле, (родной при этом перестанет играть).
2. Можно включить Мульти Пэд (MP) и правильно!!! зазвучат дополнительные партитуры MP авто аккомпанемента,
3. Начинают правильно!!! работать еще некоторые встроенные функции, (об этом позже) которые не работали (или не корректно работали) при воспроизведении обычных (не стилевых) Demo Songs. При этом, в записи самого файла, Ваши переключения ничего не изменяют (да и не могут изменить – пресетные Demo не доступны для копирования или редактирования обычными способами) !! Такие великолепные возможности уже заложены в файле и появились благодаря прописанным в нем нужным MIDI SysEx и Meta event ! Вот это именно наш случай! 
Yamaha нигде не описывает такой способ записи Song с использованием Авто аккомпанемента, но сама им пользуется !?
Как говорят музыканты: "Лажа!" (Книгу жалоб можно скачать по адресу: см. "Руководство пользователя" на Ваш инструмент). Я, с некоторых пор, тоже часто использую такой способ записи файлов. Это здорово помогает при создании собственных аранжировок.
## Урок 2 Как это работает
Тема1: Управление PSR инструментом с помощью MIDI сообщений.
Как я говорил на уроке №1 - все что мы «делаем руками», обращаясь к различным органам управления инструмента, (на самом деле даже на много больше того !!) инструмент может «делать сам», под руководством команд, поступающих к нему в виде сообщений о управляющих МИДИ событиях записанных в виде SysEx и/или Meta Events. Есть два способа доставлять эти команды до внутреннего компьютера Вашего инструмента.
Первый способ.
Эти команды по кабелю, по-одной, по-очередно, последовательно (МИДИ это «последовательный порт») , поступают из вне (от внешнего секвенсора), в реальном времени, через МИДИ интерфейс, тут же распознаются и (с минимальной задержкой) выполняться. При необходимости, могут одновременно перезаписываться на собственный внутренний секвенсор инструмента.
Важно! Не все что записано в МИДИ файл может быть передано по кабелю через МИДИ интерфейс. К таким в первую очередь относятся сообщения из группы Meta Events. Например: указание тональности, размера такта, темпа, тактовые маркеры, текстовые сообщения и т.п. Они включаются в МИДИ файл, управляют работой инструмента, но не передаются через МИДИ интерфейс.
Есть и другой способ – без МИДИ интерфейса - последовательность таких команд, (по всем правилам написания МИДИ файла, вместе с «пристегнутой» к каждой команде временной меткой, в которой указано время, прошедшее от предидущего события), записывается на внешнем секвенсоре вашей DAW в МИДИ файл. В дальнейшем (поскольку это в первую очередь, все таки компьютерный файл) данные могут храниться или переноситься в инструмент на любом стандартном носителе информации : флоп-диск, флешка, хард-диск и т.п. или передаваться на внутреннюю память инструмента через USB, кабельные сети, Wi-Fi …в зависимости от того, что имеется на борту Вашего инструмента. МИДИ файл, загруженный в инструмент, (в отличии от передаваемого в реальном времени по кабелю через МИДИ интерфейс), может быть воспроизведен автономно, в любое время. При таком способе загрузки Meta Event , прописанные в файле, будут участвовать в управлении инструментом. Скорость считывания информации с внутренних носителей, во много раз превышает скорость передачи данных через МИДИ интерфейс, кроме того происходит обязательная буферизация информации ( это когда перед воспроизведением часть или весь МИДИ файл загружается в ОЗУ ). При таком воспроизведении практически отсутствуют задержки исполнения между отдельными, одновременными МИДИ командами. Только при таком воспроизведении можно услышать все преимущества современного (1960 тиков на четверть) "микроскопического квантования времени" в МИДИ файле. Но, в обеих способах, что бы это работало, МИДИ команды нужно сначала записать. Существуют команды стандартные - понятные всем инструментам и эксклюзивные SysEx - понятные только для Yamaha или даже только для конкретной модели (серии) Yamaha инструментов.
Секвенсоры, встроенные в PSR, умеют создавать только конкретный перечень таких команд, но чаще всего, не позволяют делать по-байтовое написание и редактирование данных в SysEx и Meta сообщениях, хотя в пределах одного файла «умеют» их копировать, вставлять и удалять. Проще и нагляднее это делать на внешних DAW, (например Yamaha XGWorks). В пределах заложенных возможностей встроенного секвенсора их можно создавать и на самом инструменте. Об этом позже.
Требования к инструменту, на котором это можно выполнить: Это инструменты Yamaha c секцией Авто Аккомпанемента, Song Creator, Style Creator, Sound Creator, приведу (не полный) перечень инструментов на которых это должно работать.
PSR-1000, 1100, 1500, 2000, A200, 2100, 3000, A3000, 8000 , 9000
PSR-S 500, 550, 650, 670, 700, 900, 710, 910, 750, 950, 770, 970
CVP 201, 301, 601, 701, 709
CVP-701,705,709 (2015г)
CVP-501,503,505,509 (2009г)
Tyros, T2, T3, T4, Genos
Класс инструмента определяется параметрами встроенного звукового модуля, которые в свою очередь можно разделить на 4 главные группы, и параметрами клавиатуры (здесь не рассматриваются).
Основные параметры звукового модуля:
1. Multi Part (16, 32) и Polyphony (max) (32, 64, 96, 128 и более), количество Voice, Style
2. Количество и «мощность» встроенных Effect Blocks, DSP (от 3 до 8).
3. Style Multi Part (от 4 до 8)
4. Наличие и возможности Встроенного секвенсора, Мульти пад, Harmony, Registration Memory и др. доп функций.
Чем выше цифры тем выше класс и цена инструмента. Сравнив "начинку" можно найти аналоги (по звучанию!!!) между PSR и CVP.
## Урок 3. Как это работает. Терминология.
Тема1: Управление PSR инструментом с помощью MIDI сообщений.
Что бы лучше понимать друг друга давайте уточним язык общения.
Есть необходимость договориться о русских вариантах терминов, используемых в данных статьях. В переводных вариантах « Руководств», которые самостоятельно делают разные дилеры, не редко используется не однозначная терминология. 
Зачастую, в пределах одной книги одни и те же термины < трек, канал, инструмент, партия, дорожка, секция, раздел и т.п. > в разных местах текста, путаются и применяются к разным вещам, что усложняет и без того не легкое понимание инструкций. 
Здесь и далее будем стараться придерживаться следующей терминологии:
Современные Yamaha PSR инструменты имеют встроенный звуковой модуль с параметрами Multi Part не менее 32 и Полифония 32, 64, 96, 128 или даже больше. Количество Voice и Style (с учетом USER) может доходить до 1000.
Multi Part =32 означает, 
что процессор вашего инструмента может одновременно выполнять 32 не зависимые программы по созданию звука 32 различных партитур музыкальных инструментов. Можно сказать так: внутри есть 32 равноправных, одинаковых синтезатора. В каждый из них, по умолчанию, по команде исполнителя или по МИДИ команде, в любой момент времени, всегда загружена одна своя программа управления синтезатором. Для каждого Voice в памяти инструмента заложена персональная программа, создающая этот Voice. Собственно, сама программа, практически одинаковая, поскольку все 32 синтезатора «собраны по одинаковой схеме» и работают по единому принципу - Yamaha AWM синтез. В синтезатор Загружается персональный для данного Voice набор параметров Программы разбиты по банкам. В одном банке может находиться не более 128 Voice-программ. По стандартам GM, GS(Roland) и XG (Yamaha) в пределах одного банка Инструменты ( и строго соответствующие им имена и номера Voice-программ ) разделены в 16 групп по 8 инструментов (16 х 8 =128 ). Например: у программы №58 из группы BRASS Базовое имя Voice = Trombone. Если в инструменте заложены несколько типов <Trombone> все они будут иметь №58 но каждая будет в своем банке. ( Для группы < Mega Voice > это правило не работает ). Чтобы выбрать программу, по которой создается конкретный звук (Voice) для каждой из Multi Part необходимо задать два параметра: «Выбрать номер банка» - производится MIDI командами < Bank Select > и «Выбрать № программы в банке» - производится MIDI командой < Program Cheng >. При включении инструмента, в режиме XG, по умолчанию (XG Default) на всех «свободных от работы» Multi Part включается программа №1 Grand Piano из банка номер 00 00.
Полифония 
определяет максимально возможное, одновременно звучащее количество нот, во всех активных в данный момент партиях. Полифония динамически распределяется между Партиями –и расходуется по мере увеличения количества одновременно звучащих нот. При превышении лимита последняя новая нота (нажатая сверх лимита клавиша) выключит первую. Можно резервировать полифонию для каждой партии. Партия ударных имеет приоритет т.е. если полифония «израсходована» то отключаться будут другие партии (не ударные инструменты).
Количество одновременно нажатых клавиш не обязательно соответствует использованной полифонии! В PSR инструментах есть режим Leer - наслоения Voice. Например у Tyros для партии правой руки «под одну клавишу» могут быть наслоены три Voice R1 R2 R3. Т.е. нажал одну клавишу и "съел" 3 полифонии.
Chanel (Канал) Здесь и далее, если нет доп. уточнений, будем понимать МИДИ Канал.
Track (Трек) - это дорожка с записью МИДИ сообщений или цифрового аудио.
SMF – Standart Midi Fail Файл содержащий МИДИ данные. Если данные оформлены в виде одного трека это SMF Format0, если треков несколько это SMF Format1.
SFF – Style Fail Format. Формат записи Стилей Yamaha. (см. ниже)
Для каждой из Multy Part, по умолчанию, или вручную, задается № приемного МИДИ канала (Rcv CHANEL). № МИДИ канала это условная метка, идентификатор, прикрепляемый к МИДИ сообщению. Сообщения, имеющие идентификатор МИДИ канала, называются канальными. По бирке с номером МИДИ канала, компьютер сортирует сообщения и определяет на какие Multi Part нужно их отправлять.
Стандартные GM канальные Midi Event (сообщения), управляющие параметрами синтеза звука данной Part, являются универсальными и одинаково распознаются всеми инструментами, поддерживающими стандарт GM (GM2). Использование в SMF файлах стандартных команд гарантирует корректную воспроизводимость МИДИ файлов на различных инструментах. Перечень стандартных канальных сообщений которые поддерживает Ваш инструмент См.в DATA LIST таблицах MIDI CHANEL MESSAGE(1) и (2). 
Стандарт GM (GM2) предусматривает возможность использования и устанавливает правила написания производителями собственных Системных Эксклюзивных Сообщений (System Exclusive Message) SysEx. Yamaha XG стандарт через MIDI SysEx сообщения предоставляет доступ к 120 параметрам управления синтезатором звука для каждой Multi Part .
Подробнее см.< MIDI Parameter Change table (MULTI PART).> А так же дает МИДИ доступ к более чем 40 параметрам управления для каждого встроенного процессора эффектов (DSP).
см.< MIDI Parameter Change table (EFFECT1) / (EFFECT2).> 
STYLE – файл в котором записаны все инструкции по Real Time управлению работой секции Авто аккомпанемента. Ямаховские Стили пишутся в формате SFF - Стиль Файл Формат. На протяжении многих лет стиль файлы имели расширение < .sty > .
В настоящее время, количество применяемых расширений выросло, используются расширения:
pst (pianist); pcs (piano combo); sst (session);prs (pro); bcs (basic) and fps (free play).
Старые инструменты могут не поддерживать новые стили по разным причинам. О том, как преодолевать эти проблемы поговорим позже.
На сегодня, стандартный полный Ямаховский стиль может иметь до 17 секций (Style Section)
INTRO A,B,C,D
MAIN A,B,C,D
FILL IN AA,BB,CC,DD
BREAK FILL
ENDING A,B,C,D
Yamaha SFF формат устанавливает что в Авто аккомпанементе участвуют до 8 "музыкантов". Т.о. работающий стиль забирает для себя 8Multi Part и теперь, согласно прописке, я их называю Style Part.
В каждой (одной) Style Section, могут быть прописаны до 16 нотных треков. Т.е. для одной Style Part (Стилевой партитуры) может быть несколько вариантов (несколько треков) нотных фраз. Выбор трека с вариантом исполнения автоматический и задается в спец таблице, входящей в состав стиля, (например один для мажорного аккорда другой для минорного) но при этом, одновременно в стиле звучит не более 8 Multy Part. !!! Т.е. одновременно читаются и играются только 8 из 16 строчек (треков) нотной партитуры стиля.
Такая возможность в SFF была заложена давно, но в старых стилях Yamaha этим почти не пользовалась. Для сравнения: в стилях Roland такая фишка была на много раньше. Это приятно украшает стиль но и усложняет его написание.
Не трудно подсчитать: для создания хотя бы 4-х секций MAIN A B C D собственного (полноценного 16 трекового) стиля длиной по 4-такта нужно написать 4 Х 4 х 16 = 256 тактов партитур!!! Добавьте к ним по 4 варианта INTRO + ENDING в среднем по 3-4 такта каждый =12-16 тактов, 4 FILL IN A B C D + BREAK FILL = 5 тактов Итого 256 + 20х16= 576 тактов нот!!! Но Стиль это не только нотные партитуры а еще и выбор и запись в стиль кучи параметров, определяющих правила транспонирования, правил прерывания ноты при смене аккорда, условий выбора варианта партитуры и т.д. В состав современных стилей добавляют еще несколько совершенно не нотных разделов. (О устройстве Стиля см. Руководство. Для продвинутых: позже я дам ссылку на статьи о устройстве всех Ямаховских Файлов, SMF и Style файлы это далеко не все что есть в Вашем инструменте)
Процесс написания качественного, полноценного Стиля « с нуля» на много сложнее чем записать SMF Song. Очень серьезно помогает в написании Стиля <Style Creator>. При желании - поговорим и о нем.
Авто аккомпанемент работает с стилями. Файлы стилей со своими именами, «пришитыми» к ним номерами иконок (и конечно же с файловыми трех-буквенными расширениями), зашиты в память инструмента. Полное имя файла стиля можно увидеть в любом компьютере в вкладке «Свойства» файла. Эти имена стилей и «пришитые к ним» иконки появляются на дисплее инструмента когда мы вызываем какой либо Стиль из загруженного в инструмент банка стилей. Внутри инструмента стили имеют свой «внутренний» (програмный) короткий (обычно 2-х байтовый) номер. По внутреннему номеру стиля можно вызвать его загрузку в секцию Авто аккомпанемента с помощью Song SysEx Message, записав такую команду в SMF Song файл. Существует внутренний номер стиля в банке стилей данной конкретной модели PSR/Tyros. Этот же, или чуть-чуть модернизированный стиль, Yamaha могла загрузить в банк другого инструмента, присвоив ему немного другое имя. В другом инструменте этот стиль будет «лежать в другой ячейке банка стилей», и естественно будет иметь другой внутренний «банковский номер».
Для того что бы управлять инструментом с помощью МИДИ сообщений необходимо знать «правописание» самого SysEx сообщения для Вашего инструмента, знать правила ввода в него собственных переменных данных и конечно знать откуда брать эти данные.
## Урок4 Как это работает
Тема1 : Управление PSR инструментом с помощью MIDI сообщений.
MIDI команды для управления Авто аккомпанементом.
Для работы стиля расходуются до 8 Multi Part. Все потрековые канальные настройки для Style Part и нотные партитуры завод уже прописал в Style файлах. Для воспроизведения Файлов Стиля нужен специальный секвенсер, который читал бы треки Стиль файла в режиме зацикленного (безконечного) лупа, и кроме того приводил бы все партии стиля к одной тональности. Да-да, ведь SFF формат только «для простоты понимания» говорит что все партии стиля нужно записать на одном аккорде например типа CM7. На самом деле, в реальном стиле, партия Bass может быть записана в СM7 а гитара Chd1 в F#m9. Попробуйте воспроизводить Стиль обычным секвенсором, заменив расширение на привычный для него <.mid>. Вам обязательно попадется какая нибудь секция MAIN A B C или D где разные партии стиля играются в разных тональностях. Кроме того «стилевой проигрыватель» должен «по-быстрому, на живо» менять ноты партитуры во всех партиях стиля в соответствии с нажатым (или записанным) аккордом. Из доступных (бесплатных) программ для работы с стилями ничего лучше Yamaha XGWorks не посоветую. Похожая Эксклюзивная програмка для работы с файлами SFF уже заложена в Ваш инструмент и она прекрасно управляется Эксклюзивными командами SysEx и/или Meta event.
Формат написания данных (Data Format) SysEx сообщений, управляющих работой Стиля в Вашем инструменте, обычно приводится в скучненькой, тоненькой книжечке «Data List на Ваш инструмент» в разделах System Exclusive Messages и Song System Exclusive Message Liste/ табличка Style/. Рассмотрим эти командные сообщения в порядке, как если бы действия по подготовке к запуску Авто аккомпанемента делал живой исполнитель: а именно
1) выбор стиля;
2) выбор активной (стартовой) секции стиля;
3) назначение включенных и отключенных партитур в выбранной секции стиля (по необходимости);
4) задать темп стиля;
5) задать первый аккорд;
6) старт стиля! 
Кстати, параметр №3 вообще не реально «менять руками» при игре «на живо», но используя МИДИ сообщения это делается легко.
1.1. Выбор стиля.
Откройте книжечку «Data List на Ваш инструмент». Найдите в Song System Exclusive Message Liste/ табличку Style/ это где то в конце книжечки. В табличке приводятся Data Format по крайней мере двух великолепных МИДИ SysEx сообщений, управляющих работой секции Авто аккомпанемента в вашем инструменте. Одно из них задает Parameter <Style No> - это выбор стиля по внутреннему «банковому» номеру стиля в банке инструмента, а другое <Style Part On/Off>. – позволяет кроме того выбрать звучащие или заглушенные партии из прописанных в выбранном стиле.
Если со вторым <Style Part On/Off> все достаточно ясно (см. ниже 1.3.) Для каждой из 8 Style Part нужно прописать в сообщении 01 если она должна звучать или 00 если она отключена. То для первого <Style No> все немного сложнее. Нужно задать всего два байта данных dd dd, (это «внутренний» шестнадцатиричный номер стиля) но я не видел ни одного Руководства на Yamaha PSR/Tyros инструменты, где бы была табличка « внутренних номеров », с содержанием типа:
Style Name <60’sRock2> = Style№ < 00 0E >
Data Format сообщения <Style No> (Parameter из группы Song System Exclusive Message) к сожалению, может быть различный для разных групп PSR и Tyros. 
Например: Для PSR-1000 и 2000 формат команды имеет вид F0 43 73 01 11 00 16 dd dd F7
Для PSR-S900/S700/T5 это будет выглядеть 
F0 43 73 01 51 05 00 03 04 00 00 dd dd F7
На практике это значит, что правильно написанная команда, которая переключает стили на PSR-3000 не будет работать на PSR – S950, Там она «пишется по другим правилам». Формат этой команды Yamaha обычно приводит в «Data List на Ваш инструмент». А вот где и как «добыть» данные < dd dd > 
( о внутренних номерах стилей) для Вашего инструмента это отдельный разговор, рассмотрим позже.
1.2. Выбор активной секции стиля <Style Section Control>
Формат написания (Data Format) SysEx сообщения Style Section Control приводится в книжечке «Data List на Ваш инструмент» в разделе System Exclusive Messages.
Выглядит это достаточно просто F0 43 7E 00 ss dd F7 
Данные для ss и dd берем там же (в книжечке, чуть ниже) из таблички. SS - это условный номер секции стиля, а dd – это выключатель, dd=7F секция Вкл / dd=00 секция Выкл. Это сообщение более универсальное и, в таком виде, работает на большинстве PSR /Tyros инструментах. Эта команда переключает секции стиля аналогично нажатию на кнопки. В своих заводских файлах, Yamaha иногда, прежде чем включить новую секцию, пишет сначала команду «выключить текущую » и тут же следом «включить новый номер». Я не использовал команду «выключить секцию» а сразу « Вкл новую секцию SS» все работало. Возможно для некоторых инструментов это может потребоваться.
1.3. Выбор включенных или отключенных партитур <Style Part On/Off> в активной секции стиля
Эту команду мы уже упоминали выше в п. 1.1. ее формат
F0 43 73 01 51 05 00 00 08 01 01 01 01 01 01 01 01 F7 ГДЕ 01 =вкл 00=выкл.
Здесь 08 это количество байт данных в команде = числу партий в стиле. Rhy1 Rhy2 Bass Chd1 Chd2 Pad Phr1 Phr2. Как видите – это групповая команда, всегда нужно указывать статус всех 8 партий стиля, т.е. если нужно в авто аккомпанементе (временно) выключить например только бас, то команда будет выглядеть так : F0 43 73 01 51 05 00 00 08 01 01 00 01 01 01 01 01 F7 . По умолчанию, в голову МИДИ файла, в котором используется Стиль, автоматически ставится команда «Все партии стиля включены» т.е. все восемь байт данных одинаковы и равны 01.
Чуть-чуть теориии
Не забывайте! Это важно! МИДИ это командно- ориентированный машинный язык. Да. да! Вы уже начали общаться с Ямахой на «машинном языке». Все записанные пары цифр (байты) в SysEx , Meta и вообще во всех Midi Events (сообщениях) пишутся в шестнадцатиричном цифровом коде. На таком языке уже можно не только давать команды, а и напрямую записывать, изменять и читать содержимое внутренней памяти Вашего инструмента. Можно с внешнего секвенсора отправить команду-запрос типа: «Кто у меня сейчас висит на МИДИ кабеле ?» (На самом деле, команда запросит «что записано в памяти по адресу 01 00 00.) И инструмент в ответ сам отправит сообщение (на том же языке!) расшифровав которое, Вы узнаете его заводское имя, записанное на заводе в его память! И все это пишется цифрами в шестнадцатиричной ( на Греческом HexaDecimal ) системе исчисления. 
Первые 10 цифр в шестнадцатиричной системе (0,1,2…9, A, B, C, D, E, F) заимствованы из привычной нам арабской десятичной а далее к ним добавлены еще 6 буквенных символов. Это очень часто приводит к путанице: например сочетание цифр< 40 > в шестнадцатиричной системе будет обозначать десятичное число 64. Таблица перевода из одной в другую систему есть в той же книжечке «Data List на Ваш инструмент». Будьте внимательны! Что бы уменьшить путаницу в текстах часто к шестнадцатиричному числу добавляют префикс <H> Hex. Например: 40H = 64decim
1.4. Задать темп Стиля < Style Tempo Control >
Формат написания (Data Format) SysEx сообщения Style Tempo Control приводится в книжечке «Data List на Ваш инструмент» в разделе System Exclusive Messages
Выглядит это так F0 43 7E 01 t4 t3 t2 t1 F7 нужно задать значения для четырех байт.
1.5. Задать аккорд < Chord Control >
Формат команды находим там же 
F0 43 7E 02 cr ct bn bt F7 
Нужно задать значения для четырех байт. Варианты значений приведены там же в табличке. Как видно из формата, с помощью этой SysEx команды можно задать одновременно два управляющих аккорда для стиля: один < cr ct > задает тонику и тип аккорда для всех партий стиля, а другой специально для партии баса <bn bt>. Они не обязательно совпадают!! Это еще одна прекрасная возможность разнообразить Авто аккомпанемент. Менять вручную, на ходу, варианты аппликатуры управления Авто аккомпанементом, для изменения партии баса, практически невозможно! Но с помощью МИДИ сообщений – это делать не сложно. Можно задать «немой аккорд», отключающий все партии Авто аккомпанемента, или задать «немой аккорд» только для баса, или заставить бас играть весь свой ритмический рисунок на одной тонической ноте… МИДИ управление Авто аккомпанементом намного «тоньше» ручного! Последовательность аккордов легче и точнее вводить в пошаговом режиме. 
Совет.
Аккорды гармонии, записанные в МИДИ файле, это очень полезная информация и если есть возможность то их следует туда записать. Причин для этого более чем достаточно:
1. Аккордовая последовательность – «главный менеджер» по работе Авто аккомпанемента.
2. Даже если вы не используете авто аккомпанемент, записанные Аккорды выводятся на дисплей и это дополнительная «Караоки подсказка» для Вас или для гитариста, который стоит рядом и не очень знает гармонию.
3. Некоторые вспомогательные функции PSR для корректной работы требуют задания аккорда. (О них мы поговорим отдельно).
Не поленитесь их (аккорды) записать в файл и Вы будете приятно вознаграждены! Как это делать правильно и точно см. руководство пользователя, или подождите, мы рассмотрим это отдельно! 
Откройте Вашу DAW ( Я по прежнему рекомендую это делать на XGWorks) и создайте в ней простенький МИДИ файл в котором в первом такте будут записаны команды 1.1. / 1.2 / 1.3 /1.4 Во втором/ 1.5/ а далее, можно через каждые 2 такта на первую долю записать смену аккорда (1.5) и в 5-м такте переключить секцию стиля (1.2.) попробуйте записать команду Ending3 или4. 
Для команды 1.1.<Выбор номера стиля> для параметра <dd dd> поставьте 00 00. Скорее всего, это и будет внутренний номер Первого стиля из Первой группы стилей в Вашем инструменте.
Если все предыдущие пять пунктов были записаны на внешнем секвенсоре и сохранены (с именем) как Song SMF файл (хотя бы для 8 тактов первого куплета) , то уже можно послушать результат. 
Перенесите Ваш файл с DAW на инструмент, загрузите его как User Song и нажмите SONG START. Если Вы все сделали правильно - Секвенсор инструмента «стартанет», такты «побегут», но- –о-о-о-о музыка не появится ??!! ……Да и с чего бы появиться звукам??
Вы запустили Song в котором нет ни одного трека с командами типа Note On - Note Off (Нота нажата – Нота отпущена). Если просмотреть содержимое треков Вашего файла в Song Creator там будет пусто (кроме вкладки SysEx). Ни для одного трека не прописаны контроллеры громкости , нет Номера банка, програм ченж и т.д. 
Они собственно здесь и не нужны.?! Мы хотим, чтобы играл стиль? Все потрековые настройки для стиля завод уже давно записал в сам стиль. За все уже заплачено! Давай, играй! 
Спокойно! Все записанные в файле команды относятся только к управлению секцией Авто аккомпанемента. Только Стиль (Авто аккомпанемент) на них реагирует и вроде бы только он и должен был заиграть!!!? Но не заиграл! ….. Все правильно, Команды не было! 
Если при запуске такого файла кроме кнопки SONG START Вы одновременно нажмете кнопку Style Controle <START> чудо должно запуститься. 
## Урок 5 Как это работает
Тема1 : Управление PSR инструментом с помощью MIDI сообщений.
MIDI команды для управления Авто аккомпанементом. (продолжение)
1.6 < STYLE START >
Я уже писал в первом уроке, все что мы делаем руками (и намного больше того) можно сделать с помощью МИДИ команд. Для того, что бы, в нужном месте, по команде из <Song-a>, стиль сам включился, как минимум, эту команду туда нужно записать!!! Логичное ее место в файле - где то после всех подготовительных (выбрать стиль, секцию и т.д.) команд 1.1….1.4 (см. урок №4) на первой доле нового (обычно второго) такта, вместе с первым записанным аккордом 1.5 (По аналогии ручного запуска Авто аккомпанемента с «Синхро Старта» – все подготовили, нажали аккорд и «ОНО стартануло», нужным стилем, нужным темпом, с нужного первого аккорда и т.д.) 
Опять таки, Yamaha ни в одной книжечке не пишет- как выглядит эта команда. Но, ведь в своих Ямаховских пресетных миди файлах из группы «Style Demo SONG» стиль «сам включается»! Попробуйте отыскать это SysEx сообщение самостоятельно, открыв заводской пресетный Style Demo SONG в Song Creator/ вкладка SysEx. Искать нужно на первой доле такта, в котором Вы услышали, что стиль включился, обычно на тике с записью первого аккорда Song-a. Это немного сложная задача для начинающих.
Подсказка:
Команда < STYLE START > не длинная (всего 5 байт) и имеет формат F0 43 XX XX F7. Поищите эти недостающие два байта XX XX среди записанных Yamaha. Для уверенности – перепроверьте, открыв еще один (другой) «Style Demo SONG».
Что выводится на дисплей.
Чтобы созданный на внешней DAW МИДИ файл с записью треков Песни (Song), воспроизводился на встроенном секвенсоре Вашего PSR, он должен быть сохранен в стандартном формате SMF0 или SMF1 и любым доступным способом загружен в секвенсер Вашего инструмента. ( Читай: его название должно появиться на MAIN дисплее в окошке SONG). По моим сведениям Встроенные Ямаховские секвенсеры (типа Song Creator) сохраняют свои Song только в формате SMF0. 
Просмотр и редактирование загруженного в инструмент миди файла производится встроенной утилитой [SONG CREATOR]. Доступ к ней у разных PSR и CVP может отличаться, но в основном, это нужно искать в вкладках DIGITAL REC MENU/ SONG CREATOR. Среди всех доступных вкладок в <SONG CREATOR>, нас будут интересовать <CHD> и <SYS/EX>. 
Для того, что бы разобраться с тем - где и как Yamaha записывает в SONG команды управления Авто аккомпанементом, загрузите какой либо заводской (пресетный) SONG/PRESET/STYLE/ Имя файла. Обычно, в названии такого Song-а присутствует имя встроенного в инструмент стиля, который использовался для демо-записи. Путь к Song файлу может быть различный, но в конечном итоге, в результате загрузки его название должно появиться на [MAIN] дисплее в окошке <SONG>. Одновременно, рядом, в окошке <STYLE> вместо имени стиля загруженного по-умолчанию, должно появится название стиля, используемого в файле. Названия [Song] и [Style] могут совпадать или будут очень похожи. Это 100% признак того, что при записи сонга использовался стиль. 
Например: - в моем варианте, в обеих окошках < 8Beat Modern>. Это говорит о том, что загружен Song по имени < 8Beat Modern> и по прочитанной команде, (записанной в голове этого Song), в секцию Авто аккомпанемента уже загружен и готов стартовать Style < 8Beat Modern>.
Информация к размышлению.
1. При воспроизведении заводского Demo- сонг- файла, после нажатия только одной кнопки ( это кнопка [START] в секции [SONG] панели управления), произойдет старт сразу двух секций инструмента: SONG и STYLE . На [MAIN] дисплее в секции [Lyrics] начнут меняться аккорды, появятся мигающие точки над фейдерами [SONG] и [STYLE] <BALANCE>, и в секции <STYLE CONTROL> начнут происходить автоматические переключения как при «живом» ручном управлении кнопками. При воспроизведении «обычного» МИДИ файла (в котором нет команд управления стилем) секция STYLE CONTROL и фейдер Style- BALANS не активны.
2. Попробуйте «вручную» кнопками, переключать Стили, и/или «подвигать» фейдерами [Style Balans] и [Song Balans] при воспроизведении такого заводского демо-сонга – будете приятно удивлены!!!
Вернемся к тому: что и как выводится на дисплей.
В [Song Creator] вкладка [SYS/EX] различные типы SysEx events и/или Meta events сообщений, Ямаха выводит на дисплей по разному:
1. Все Ямаха эксклюзивы начинаются с F0 43 …а Ямаховские Мета сообщения с FF 7F 43.
2. Если Эксклюзив, или Мета сообщение, входит в список знакомых, «занесенных в память инструмента», то на дисплее вообще может не быть Sys/Ex. F0 43 … или Meta FF 7F 43…. а все будет уже на «человеческом (англ) языке». 
Например: Meta сообщение о том, что в данном файле ноты появятся начиная только с второго такта, на дисплее PSR в [Song Creator] вкладка [SYS/EX] будет выглядеть как [ <ScBar 1 Score Start Bar>] хотя на другом (внешнем) секвенсоре, у которого в памяти нет записной книжечки с Ямаховскими командами, на его месте Вы увидите реальный текст этого эксклюзивного цифрового сообщения в виде 
FF 7F 06 43 73 0A 00 04 01 без расшифровки что это такое.
3. Группа Yamaha XG SysEx эксклюзивов (см. MIDI Parameter Change Table) работает напрямую с адресами памяти и имеет формат F0 43 10 4C hh mm ll dd ….F7 . При выводе на экран, одинаковые для всех команд этого типа, первые 4 байта заголовка F0 43 10 4C опускаются. Сообщение на дисплее PSR выглядит как [ < XGPrm hh mm ll dd …F7 >] . Где < hh mm ll > адрес памяти, куда по этой команде запишутся новые данные < dd >. С помощью таблиц <MIDI PARAMETER CHANGE TABLE> по указанному в команде адресу можно «расшифровать», о каком параметре конкретно идет речь.
4. Другие Yamaha SysEx сообщения выводятся на дисплей в «оригинальном побайтовом цифровом виде». Для расшифровки их содержания приходиться обращаться к “Data List”, к экспериментам, к интернету и т.д. иногда ответа нет! Иногда, инструмент сам прописывает в файл SysEx команды, назначение которых нигде не расшифровывается. Например: [ 000:1:0000 Sys/Ex. F0 43 01 61 F7]. (Я не знаю его назначения !!!). Это, могут быть команды для «заводских служебных программ», на которых писались демо сонги или для других Yamaha soft или hard устройств. О них нет записей в «записной книжке» Вашего инструмента, они могут и не распознаваться Вашим инструментом и не влиять на его работу. Но это не повод чтобы их обязательно удалять, хотя удаление это простейший способ узнать для чего они нужны!
5. Кроме того длинные SysEx и Meta команды, не умещаются на дисплее инструмента и если отсутствует горизонтальная прокрутка, то их бывает трудно идентифицировать. 
Для тех, кто не нашел самостоятельно (или не захотел искать) как выглядит SysEx < STYLE START > (см. предидущий урок), рекомендую открыть любой Ваш пресетный Style Demo. Путь к нему, примерно такой: дисплей[MAIN] SONG/PRESET/Style/НазваниеSong/Song Creator/вкладка SysEx / и где то в позиции первой доли 001 такта найти на дисплее строчку, похожую на приведенную ниже:
001:1:0000 Sys/Ex F0 43 60 7A F7
Это и будет команда “STYLE START”. ( «Старт Авто аккомпанемент»).
Аналогично, в конце <Style Demo Song> должна быть похожая команда “STYLE STOP”. Ее уж точно можно найти! Она отличается только одним байтом, точнее - всего одной цифрой. 
Обе команды, опять таки, по не понятным причинам, Yamaha не декларирует в Руководствах пользователя.
Для ленивых: она выглядит так F0 43 60 7D F7 
«Шукайте, девчата! Должно быть…!» - говорил дед Кузьма.
Теперь вернитесь к внешнему секвенсору, на котором Вы писали свой МИДИ файл на уроке №4. Поставьте (запишите вручную по-байтово) добавьте в своем файле, на треке где размещены все эксклюзивы, в позиции «сразу за первым аккордом, на том же тике» эксклюзивную команду F0 43 60 7A F7 “STYLE START” . Для продвинутых - в конце трека можете таки поставить и F0 43 60 7D F7 то же.
Сохраните изменения в МИДИ файле, перенесите его (файл) назад на Ваш инструмент , загрузите и нажмите SONG START. Если все было выполнено правильно – у Вас есть шанс услышать, как «Авто аккомпанемент» сам включится и заиграет Стилем по записанной Вами гармонии (последовательности аккордов)!!! Если и вправду все зазвучало с первой попытки - подойдите к холодильнику – Вы заслужили!
Это не самый легкий способ создания <Beking Track> с помощью «Авто аккомпанемента», особенно, если Вы писали эксклюзивы на внешней DAW, не «заточенной» под Yamaha SysEx. Поэтому, еще раз рекомендую - легче делать это с помощью Yamaha XGWorks или XGwork ST.
Прибегать к помощи внешнего секвенсора приходится по единственной причине – в Ямаховских встроенных секвенсорах типа <Song Creator> не предусмотрено вручную прописывать SysEx и Meta сообщения. 
## Урок 6. Как это работает
Тема1. Управление PSR инструментом с помощью MIDI сообщений.
MIDI команды для управления Авто аккомпанементом. (продолжение)
Как рекомендует Yamaha делать записи с использованием «Стиля», достаточно подробно описано в "Руководствах пользователя". Предлагается 2 способа: вживую (наживо) задавая аккорды на клавиатуре и переключая секции Авто аккомпанемента или пошагово. Нас будет интересовать второй способ - пошагово, с помощью <Song Creator>. Главное его преимущество в том, что можно очень точно расставить (по времени) все команды управления Авто аккомпанементом и легко корректировать время расстановки, если команда исполняется не очень вовремя, проще задавать «сложные аккорды», проще задавать аккорды, в которых бас играет не по гармонии основного аккорда ( их можно просто «вписывать буквами»), и т.д. 
Пишем наш < NewSong > с нуля и только на PSR.
1. В секции [SONG] панели управления нажать одновременно две кнопки [REC] +[TOP] =NEW SONG. На [MAIN] display в окошке [SONG] появилось <NewSong>.
2. Заходим в DIGITAL RECORDING/SONG CREATOR : NewSong/CHD.
<Song Creator> вкладка [CHD] предлагает Template (заготовку, шаблон) из 14 команд управления в которые (по умолчанию) занесены стартовые значения настроек работы Стиля. Эти настройки можно и нужно менять по своему усмотрению. Среди них: - «обычные » - это те, которые всегда задает исполнитель кнопками панели управления перед тем как начать играть в живую и дополнительные «расширенные» доступ к которым с панели управления очень затруднен или вообще невозможен при живой игре. 
К первой группе можно отнести команды: - выбор стиля, выбор секции стиля, назначение темпа стиля, назначение общей громкости Стиля (положение фейдера <Style Balans>), задание стартового аккорда… и некоторые полезные стандартные и «служебные» [Meta events] (размер такта, тональность, установленная и поддерживаемая Вашим инструментом версия Yamaha XF Meta event,) которые секвенсор инструмента сам вводит в создаваемый МИДИ файл.
К второй группе можно отнести команды: задания активных (включенных) и не активных, (отключенных) партий стиля, назначение громкости каждой из восьми партий стиля (эти параметры можно увидеть и изменять только на <MIXING CONSOLE (STYLE PART )> .
Все 14 команд стартовой предустановки режима работы Стиля, прописаны в такте № 001 на метке [Bar001/ Beat1 / Clk 0000 ] т.е. до такта № 002 в котором будет стартовать стиль. Некоторые из этих параметров (не все), можно будет изменять в следующих тактах по ходу записи.
Откройте вкладку [SYS/EX]. Там тоже уже записан «шаблон» из 6 правильных и полезных команд-сообщений которые Ямаха всегда сама вставляет в голову файла, создаваемого на <SONG CREATOR>. Среди них: <Включить GM1>, <включить XG>, Meta сообщение о том, что старт музыки будет в такте №2 и др. Их не нужно изменять. 
Обратите внимание – в вкладке [SYS/EX] все 6 команд записаны в такте № 000 т.е. еще раньше чем 14 команд из вкладки [CHD]. Это имеет смысл и соответствует «Cтандартным рекомендациям правильного построения SMF файла»: в начале, через сравнительно большие интервалы времени, пишутся все «общесистемные» команды, перенастраивающие весь инструмент и требующие для выполнения относительно много времени. Затем - команды управления уже «перестроенными ранее секциями» и блоками инструмента, затем Стандартные канальные МИДИ сообщения и < XGPrm эксклюзивные сообщения> задающие настройки для работы всех задействованных <Multi Part> (даже если они мало или вообще не отличаются от заданных ранее по умолчанию) и только потом начнутся привычные партитуры Nota On / Nota Off. Такого порядка записи команд, следует придерживаться всегда, на любом секвенсоре. Возьмите это за правило! Он намного упрощает последующую рабочую редакцию МИДИ треков
3. Возвращаемся в <SONG CREATOR> на вкладку [CHD], нажимаем кнопку [STEP REC] и следуя инструкциям Руководства пользователя, контролируя размер шага [STEP RECORD], не выходя из вкладки [CHD], начиная с 2-го такта вводим потактовую гармонию (Аккорды) песни, далее в нужном такте запишем переключение секций стиля, включение-выключение партий стиля и т.п. 
Перечень команд которые разрешено вводить посреди песни, и минимальный размер временного шага между командами (он равен «два шага на четверть» т.е. 1/8 или 960 тиков) <Song Creator> ограничивает автоматически. Прослушать и оценить правильность работы стиля (только стиля!) по записанным командам можно, вернувшись к началу записи и нажав <SONG START> при этом нельзя выходить из окна вкладки <CHD> !!!
О чем упорно молчит Yamaha.
Все дело в том, что пошаговая запись команд в вкладке [CHD], не смотря на сравнительно понятный их вид на дисплее, производится в специальном Ямаховском, совсем даже не МИДИ формате!!! «Язык» этих команд, по видимому, был разработан эксклюзивно, для управления проигрывателем «Авто аккомпанемента». Такую запись, (и только ее) в оригинальном виде, на «своем языке», умеет писать и воспроизводить только Yamaha <Song Creator> и только в режиме активной вкладки <CHD>. При этом, никакие другие МИДИ треки, ( ранее или позже записанные в файле), в режиме <Song Creator> <CHD> Вы не услышите, он их не умеет читать, да и для работы плеера Авто аккомпанемента они собственно и не нужны. 
Yamaha позволяет (рекомендует по другому но мы сделаем по своему) после введения всех пошаговых команд сохранить такой файл как SMF, просто нажав на вкладке [CHD] кнопку [SAVE]. Получилось, Но! 
Сохраненный таким способом файл, (на Лунном языке) никто не воспроизведет кроме Yamaha <Song Creator> в режиме <CHD>. Я не знаю других [ Yamaha Стиль плееров] (программ или железа) которые поддерживают такой формат. 
На предыдущих уроках мы учились «Управлять Авто аккомпанементом с помощью SysEx и Meta команд- сообщений», но откройте только что созданный и сохраненный как описано выше файл в <Song Creator> вкладка <SysEX>. Там все те же 6 заготовок + 1 команда <End>, и не добавилось, ни единой команды из тех, которые мы разбирали раньше. Запись видно на вкладке [CHD] и она выводится на вполне понятном языке, но это не МИДИ сообщения, их больше никто не умеет читать! 
Служебная информация Для «продвинутых».
Если открыть такой файл «Шестнадцатиричным редактором», то можно увидеть, что у обычного МИДИ файла, в конце, появился дополнительный новый Chunk (новая секция) с именем [ChdS] или [CdS1] (очевидно сокращение от Chord Step). Вот там и записано то, что создал видит и играет только <Song Creator> в окошке <CHD>. 
## Тема. Управление Авто Аккомпанементом Yamaha PSR через MIDI.
### Глава 1. 
«Ты помнишь – как все начиналось? » А. Макаревич
Что бы все началось, сегодня, нужно сделать то же что и лет 40 назад (40 это примерный возраст первых «самограек»).
Вкл инструмент/ Вкл секцию Авто аккомп/Выбрать Стиль/Выбрать стартовую секцию стиля/Задать темп стиля/Выбрать пресетные, или задать свои, параметры для Voices R1/R2/R3/L/ установить баланс между партиями… /Вкл Синхро-старт/ Нажать первый аккорд в левой части клавиатуры - секция Авт-аккомп ./
По комбинации одновременно нажатых клавиш в секции < Авто-аккомпанемента> происходит распознавание аккорда, ( он выводится на дисплей) и начинается воспроизведение записанных (на заводе) партитур выбранной секции Стиля. При смене аккорда, партитура треков мелодических инструментов стиля (их у Ямахи 6 из 😎 транспонируется по заданным для каждой <Style Part> правилам. В современных, 16 трековых стиль – форматах, партия стиля может, кроме транспонирования еще и переключаться на другой вариант фразы в зависимости от типа аккорда и (или) его тоники. При нажатии кнопок управления Авто Аккомпанемента происходит переключение активных секций стиля и т.д.
Это далеко не полный перечень но, мы всегда это делали и делаем, и инструмент «отвечает» предсказуемыми действиями. При этом, никогда не утруждаем себя вопросами типа – «а что и как происходило в инструменте, после нажатия выше перечисленных кнопочек», ведь каждая кнопочка подавала свою команду на выполнение стандартной простой (или сложной) програмной процедуры. Нас интересовал конечный результат, выводимый на динамики и (или) дисплей! И уж точно, не интересовало, как именно выглядела (в цифровом виде) команда-инструкция для аудио и видео процессоров инструмента. Тем более, что реальный (внутренний) формат этих инструкций для различных инструментов различный и зависит в основном только от типа процессора используемого в инструменте. 
Так это зародилось, но так это и работает сегодня! Внутри инструмента с каждым годом все серьезно «усложняется» но принципы «внешних подходов к управлению» не меняются вот уже 37 лет ! И величайшая заслуга в этом принадлежит «тетра граматону» M-I-D-I.
К 1980 г у каждого производителя, (Roland, Yamaha, Korg ….) автономно все уже работало «по цифре», и вроде бы не плохо. Но, с каждым новым инструментом все острее вылезала проблема отсутствия единого стандарта цифровых команд-инструкций по управлению из вне их «внутренними компьютерами» и по записи и хранению этих команд на носителях. Уже были секвенсоры но у каждого это был свой формат, была сильная конкуренция за приоритеты и желания стать законодателем в этой области и это только тормозило дальнейшее развитие цифровых музыкальных инструментов. Нужно было договариваться. И разработчики - договорились!
Было принято одно из величайших, до тонкостей продуманных, перспективное и долго живущее, соглашение в мире цифровых музыкальных инструментов! Договор был очень даже «джентльменским» а главное – правильным с инженерной точки зрения. 
Все понимали: так-как внутри инструмента у каждого производителя находится «свой компьютер», то никто не согласится, ломать или менять свою внутреннюю начинку с кучей Ноу-Хау, подстраиваясь под кого то другого. Решение было простым и «сверх правильным» - пусть внутри у каждого остается своя схемо - техника, и свой язык команд, но поскольку есть огромная потребность общения, хранения, управления и передачи информации между инструментами, звуковыми модулями, компьютерными программами – ломать не будем! Но тогда остается только один альтернативный способ – «будем немножко усложнять!»
Было решено создать три вещи и они достаточно быстро были созданы:
а) единый машинный язык команд для управления а так же формат обмена и хранения этой командной информацией (что то вроде музыкального цифрового Эсперанто)
б) единый способ передачи команд между инструментами (стандартизованный интерфейс)
в) и естественно, в инструменте должен устанавливаться дополнительный «блочек переводчик» с Эсперанто на родной язык компьютера инструмента и наоборот.
Поскольку речь шла о MI =Musical Instrument, и Был выбран DI =Digital Interface – Цифровой интерфейс, то с названием стандарта проблем не было. Так родился новый стандарт MIDI 1.0 Specification in 1983. Чуть позже, в 1984 энтузиасты-разработчики стандарта MIDI создали и свою организацию «MIDI Manufacturers Association» (MMA).
Вот уже 35 лет, благодаря ММА MIDI и его варианты-расширения GM, GS, XG, GM2, XF и т.п. живут, развиваются и вошли в обиход и не только в мире музыкальных инструментов. Сейчас не возможно себе представить ни «профи», ни домашнюю студию, ни просто музыканта, которые не знали бы или не использовали MIDI.
В январе 2020г MMA анонсировало, очень серьезно расширенную, новую последнюю версию стандарта MIDI 2.0, которая должна будет внедряться в новых разработках (подробнее см. https://www.midi.org/). К слову, ее разрабатывали и согласовывали более 5 лет. Спешить особых причин не было. Старая версия была великолепно продумана и продолжает работать до настоящего времени. Поживем – увидим.
Для тех, кто не знаком с основами МИДИ, или не прочь освежить свою информацию, очень рекомендую почитать (см. Ссылку). Прекрасный «ЛикБез» по MIDI от нашего земляка Евгения Музыченко см. https://www.ixbt.com/multimedia/mididescrib.html...
Это серьезно облегчит понимание дальнейшего материала. 
### Глава 2. Как все работало до МИДИ или как вообще работают компьютерные программы
Все современные цифровые клавишные инструменты, состоят из двух основных блоков: клавиатура и звуковой модуль. Сегодня, это совершенно независимые устройства, каждое из которых может работать самостоятельно. Т.е. клавиатура Вашего инструмента может быть подключена к звуковому модулю Вашего инструмента (так обычно и есть по-умолчанию), а может управлять любым внешним железом или софтом и это благодаря MIDI. 
Если у Вас есть удобная по всем параметрам внешняя клавиатура Вы можете подключить именно ее к своему инструменту (или компьютеру) и работать с максимальным комфортом и это тоже благодаря MIDI. 
Можно что бы на Вашем инструменте ( на звуковом модуле Вашего инструмента) играли два исполнителя одновременно, каждый разными звуками (Voice) Вашего инструмента, каждый на своей клавиатуре 
и это тоже благодаря MIDI. 
От «классики» в теперешних электронных инструментах осталась разве что клавиатура и то она какая то … – «динамическая», «взвешенная», «молоточковая», двух или трех сенсорная …. и т.д. но об этом не сегодня и не здесь. Вернемся к MIDI ?
Диалог из жизни автора:
- MIDI разрабатывалось чтобы управлять внутренностями звукового модуля моего инструмента.?
- В основном Да!
- Но ведь до изобретения MIDI оно тоже работало и MMA говорила что «внутри ничего переделывать не нужно!? Нужно только чуть-чуть добавить!»
- Да! Поддержка стандарта MIDI не требовала серьезной внутренней переделки.
- Т.е. теоретически, сейчас, если не пользоваться MIDI, все внутри работает по-старинке?
- Да! Весь внутренний алгоритм работы инструмента у каждого производителя остался своим «классическим».
- А можно, «на пальцах», как же оно все таки работает «классическим» способом?
....Оказывается, все таки бывают... которые "интересуются" ...
#### 2.1. Что такое «классическое управление» цифровыми инструментами (типа "на пальцах")
То, что внутри инструмента спрятан «обычный» компьютер, Вы наверное догадывались. Внутри - действительно компьютер но «заточенный» сугубо под музыкальные задачи. И главная из них - это максимально использовать возможности заложенного «звукового модуля».
Забегая на перед скажу, что МИДИ код нажатия и отпускания музыкальной клавиши на инструментах во многом совпадает с кодом нажатия (отпускания) кнопки на обычной компьютерной клавиатуре. Кто у кого «одолжил» - вопрос риторический.
В современных Yamaha инструментах в термин «звуковой модуль» обычно вкладывается вся смесь бортового железа и софта работающая с встроенными семплами, + сами <Multi Part синтезаторы >, +блоки эффектов, +эквалайзеры + секвенсоры и т.д. Все это подчинено одной цели – создать из имеющегося ( и/или подгружаемого) материала различные варианты нужных звуков. 
Количество различных звуков (тембров, инструментов, Voices) которые одновременно может создавать «звуковой модуль», (наряду с максимальной полифонией) это два главнейших параметра Вашего инструмента. Первый называется < Multi Part > и у современных инструментов эта цифра не менее 32. 
«На пальцах» это обозначает, что у Вас в инструменте есть 32 равноправных, одинаковых, полифонических, независимых «синтезатора», каждый из которых может быть запрограммирован (по умолчанию или исполнителем) на создание звука одного музыкального инструмента (Voice). Любой из внутренних програмных «синтезаторов», может быть назначен в качестве исполнителя любой партии и сможет «сыграть» любым Voice из банка Вашего инструмента. Наверное поэтому у Ямахи они и называются < Multi Part >. Они действительно все одинаковые и работают по единому принципу у PSR Ямаха это называется Yamaha AWM Synthesis. 
Для работы по созданию конкретного звука «синтезатору» каждой из < Multi Part > просто нужно задать свой набор одних и тех же параметров. В Yamaha XG инструментах на каждую < Multi Part> для правильной работы «синтезатора» по умолчанию или по командам исполнителя, прописываются около 120 параметров. Для записи и хранения оперативных значений этих параметров, за каждой из < Multi Part > навсегда закреплен свой участок оперативной памяти с конкретными, стандартными, одинаковыми для всех PSR XG (и не только PSR) адресами.
Классическое управление это - любым (доступным) способом поменять циферку в нужной ячейке памяти на ту что нужно Вам. И ВСЕ!!! Дальше компьютерная программа все сделает сама!
Пауза (не музыкальная). К вопросу о Multi Part и полифонии
Вы не задумывались над вопросом: Что вообще может играть в Вашем инструменте? Или - сколько партитур (сколько по разному настроенных синтезаторов) может одновременно звучать? Самое время прикинуть:
1. Исполнитель: до 3 слоев (3 Voice) для правой руки и 1 для левой = 4 Part
2. Multi Pad до 4-х Voice одновременно т.е. тоже = 4 Part
3. Авто аккомпанемент до 8 Style Part
4. SMF плеер – стандартный МИДИ файл до 16 треков.
Если включить все это одновременно уже наберается 32 Multi Part. А еще ведь есть режим назначения Multi Part на работу от внешнего External Source! …
Не факт, что все это действительно сможет одновременно полноценно звучать - может не хватить полифонии.
Максимальная полифония это максимально возможное количество всех одновременно звучащих нот во всех активных Multi Part. 
Типичные значения max полифонии от 32 до 128, 192 и более. При превышении режима полифонии последняя новая нота (нажатая клавиша) в качестве одного из вариантов, отключит первую. Количество одновременно звучащих нажатых клавиш не обязательно соответствует израсходованной полифонии. Нужно учитывать многослойные звуки ( под одной клавишей правой руки может быть до 3 одновременно звучащих Voices R1 R2 R3 режим Layer, а так же ноты «висящие» за счет нажатого Sustain). Полноценная партия рояля (две руки с педалями) легко съедает до 80 ед. Партия ударных имеет приоритет т.е. при превышении полифонии будут отключаться другие партии, но не ударные.
Итак: в Вашем инструменте желающих поиграть более чем достаточно! А ведь еще могут быть желающие поиграть вместе с Вами на своей «внешней клавиатуре» используя Ваш звуковой модуль… 
#### 2.2. Внутренности PSR-a или Компьютер «для чайников»
Вы не забыли? Внутри инструмента действительно компьютер но, «заточенный» сугубо под музыкальные задачи. Общее устройство и схемо-техника 100% компьютерная : материнка, процессоры, тактовая частота, операционная система, BIOS, главная программа на 32 синтезатора и вспомогательные утилиты, видео и звуковые карты, видео монитор (дисплей), динамики, память, оперативка… Вот с памяти и начнем!
Все рабочие программы в «компьютерных муз инструментах» записаны в ПЗУ (Постоянная память) это ROM т.е. только ЧИТАЕМАЯ память. Версия программы «залита» на заводе, и пользователь к ней доступа не имеет. (Только полностью «перезалить»!) В прошивке, среди всего разного, записаны пресетные параметры настройки синтезатора для каждого из 760 Voices имеющихся в Банке Вашего PSR. Еще есть «оперативка». В нее каждый раз из ПЗУ для 32 <Multi Part > заносятся оперативные настроечные данные для тех 32 Voices программ, с которыми компьютер работает в данный момент. 
Все Yamaha PSR (и не только они), работают примерно так: 
1. При включении инструмента, для всех 32 синтезаторов, DSP процессоров и прочей начинки Вашего PSR, в конкретные ячейки оперативной памяти, из ПЗУ (ROM) заносятся данные настройки для 32 стартовых (по умолчанию) Voices. Вы их (не все) можете видеть на дисплее при каждом включении . Этими настройками заполняется (вся без пробелов) таблица специально отведенного одного и того же участка памяти! Ни одна ячейка этой памяти не бывает пустой!
2. Клавиатурные контролеры, контролеры кнопочек, /ручек/, сенсорного экрана/ и других органов управления, расположенных на панели управления, следят и ждут когда кто-то что ни будь нажмет или покрутит. Как только происходит какое то управляющее событие, тут же вырабатывается кодовое цифровое сообщение, которое запустит цепочку стандартных процедур. Среди них ключевая это: Сообщить процессору свежайшую новость «Свершилось! Кто то что то нажал!». Данные о этом событии, для всеобщего ознакомления, будут записаны по конкретному ХХ ХХ ХХ адресу прописки в оперативке.
3. Дальше пошла "Рутина"! Запускается процесс выполнения (все той же) стандартной программы создания звука, но с несколькими новыми данными настроек. И процессор опять пошел по протоптанной (прописанной) дорожке т.е. раздает на все стороны давно знакомые ему команды что то типа:
…Собрать исходные данные для запуска! Это значит вновь пройтись по нужным адресам памяти. В том числе, Прочитать новое число, перезаписанное в оперативной памяти по адресу ХХ ХХ ХХ , сравнить его с с записанным в ПЗУ по адресу YY YY Y0. Если совпало – дать команду на выполнение варианта программы № 60. Если не совпало – проверить совпадение с данными в YY YY Y1 / Y2/ Y3… Где есть совпадение – именно тот кусочек программы и сделаем. Ни чего «своего умного» компьютер не придумает и не сделает!!! Все варианты ходов уже давно прописаны! 
Если кто то (или что то) поменял(о) данные в оперативной памяти по адресу ХХ ХХ ХХ (например - исполнитель нажал другую клавишу не <F> а <G#> или туда были записаны результаты вычислений от предидущей операции) то будет выполняться чуть-чуть другой вариант №61 «той же программы». Если "понятных совпадений" нет, (понятные это только те что есть в памяти в «заводском списке ») – ничего нового делаться не будет…
Программа всегда, «тупо» обращается за исходными данными к одним и тем же адресам памяти и результаты «своих вычислений» то же переписывает по давно запрограммированным адресам. 
« Все уже украдено до нас!» . Операция «Ы».
#### 2.3. Data List или «Там - где знание нот ни чем не поможет!»
Я не знаю, как распределялась оперативная память в инструментах эпохи до МИДИ, но как она используется Ямахой в современных XG инструментах - приводится в описаниях на каждый PSR. Размеры (оперативной) памяти и перечень параметров за 35 лет конечно изменились, но алгоритм работы с памятью не поменялся. Это во все времена «принцип работы компьютерных программ». Рассмотрим основные идеи, заложенные в управлении Тон генератором Звукового модуля, на примере современных PSR, с современной памятью.
Найдите у себя (а лучше скачайте и читайте прямо в Ноутбуке) небольшую книжечку под названием < Data List > на Ваш инструмент. Это скучнейшее собрание таблиц, в которые 16% музыкантов заглядывали один раз - остальные и не раскрывали. Это не мешало им пользоваться инструментом, но никак не помогало играть, хотя очень даже могло …. На ближайшее время < Data List> станет Вашим «Печальным настольным чтивом». Откройте ее (книжечку) на странице с заголовком
MIDI PARAMETER CHANGE TABLE
Печалька началась!
В зависимости от модели инструмента эта, разделенная на блоки таблица ( размер каждого блока указан под ним как TOTAL SIZE), может занимать от 4 до 8 листов (8-16стр). Это таблица распределения адресов оперативной памяти Вашего Yamaha XG инструмента. Исходя из названия, это память, в которой можно менять данные, т.е. доступная для редактирования в том числе и с помощью MIDI. В таблице, построчно, начиная с Address < 00 00 00> функциональными блоками, для каждой Address ячейки памяти, (или группы ячеек с последовательными номерами адресов, у программистов это называется Dump а TOTAL SIZE соответственно размер Dump Memory) расписан Parameter который там хранится и указан диапазон возможных значений величин для этого параметра.
Адреса ячеек памяти строго привязаны к конкретному (доступному для редактирования) параметру каждого функционального блока Вашего инструмента. Эта привязка возведена в ранг стандарта, что и позволяет использовать одинаковые эксклюзивные Yamaha XG SysEx команды для всех инструментов, поддерживающих XG стандарт. Такие команды работают непосредственно с адресами памяти.
Например:
1. Данные о текущих параметрах настройки блока
( EFFECT1) REVERB всегда хранятся по адресам начиная
с 02 01 00 до 02 01 15 
( EFFECT1) CHORUS всегда хранятся по адресам начиная
с 02 01 20 до 02 01 35
2. Данные о текущих параметрах настройки для каждой ( MULTI PART ) хранятся по адресам начиная
с 08 00 00 до 08 1F 7F и так далее см. таблицу.
( Адреса в таблице записаны в шестнадцатиричной системе!). 
Если в вашем инструменте нет какого то блока - для существующих блоков адреса все равно не меняются. 
На практике это означает : если я хочу в своем «блоке эффектов» поменять тип хоруса на другой, то в любом Yamaha инструменте, (поддерживающем XG формат), мне нужно залезть в память по адресу 02 01 20 и записать туда два других числа – и все!!! 
Не такой уж он и умный, этот компьютер!
«Если ты знаешь что все зависит только от числа, записанного по известному тебе адресу – ты еще не «хакер» но точно уже не «чайник»! Осталось узнать - как до него (адреса) добраться!» В.Петренко. Избранное. Около 1988г.
#### 2.4. Работу внутреннего компьютера «на пальцах», продолжим рассматривать на примере задания настроек для «синтезатора» или Самый древний способ создания <Multi Part> Setting .
Немного терминологии.
Клавиатура PSR делится как минимум на две части: правая ( Right) и левая (Left). В правой части, возможно делать наслоение (режим Layer) нескольких Voice на одну клавишу. Для инструментов, где возможно сделать 2 слоя Ямаха называет слои Main и Layer. Где 3 слоя это R1 R2 R3 . В левой руке обычно один и это L.
Вы собрались играть на клавиатуре и для правой руки (партия R1) на главном дисплее задали Voice из Category E-Piano под названием <Galaxy EP> .
Надеюсь, что Вы уже минимально знакомы с теорией, и знаете, что для задания Voice нужно задать по крайней мере два основных параметра: номер банка где он хранится (задается котроллерами <СС00 и СС32.) и номер программы в этом банке <Program Change>.
Когда Вы остановили свой выбор на <Galaxy EP>, компьютер нашел в ROM памяти инструмента Voice file <Galaxy EP> считал с него номера для СС00 и СС32, и номер Program Change, вывел эти данные на дисплей - там появились название для R1 <Galaxy EP> и три (десятичных) числа 000 114 004, и считал еще много параметров которые были записаны в файле. Скопировал все это в оперативку см MIDI Parameter Change Table (MULTI PART) по адресам 08 00 01 08 00 02 08 00 03 и т.д. заменив данные которые там были по умолчанию, (см. туже таблицу столбик XG Default). «И было Вам счастье! И имя ему <Galaxy EP>».
Затем Вы решили установить свою (не по умолчанию) громкость для <Galaxy EP> (партия R1) на главном дисплее. Это значит что «компьютеру» предстоит поменять значение параметра VOLUME по адресу 08 00 0B (не поленитесь проверить адрес по таблице!).
И так далее, если то, что вы меняете органами управления на лицевой панели (или «тыча пальцами в дисплей») имеет отношение к <Galaxy EP> (парт R1) то все изменения будут перезаписываться и (временно) храниться в памяти по адресам MIDI Parameter Change Table (MULTI PART 00). Теперь ОНИ будут задавать новый режим работы «синтезатора» этой самой <Multi Part 00>. В данном случае она <Multi Part 00> (по умолчанию) назначена для исполнения клавиатурной партии R1. Но это то же можно переназначить по- своему!
Точно так же все другие кнопки панели управления, в конечном итоге, производят изменения параметров в ячейках памяти по адресам других < Multi Part >, Блоков Эффектов и других функциональных узлов Вашего инструмента . см. другие разделы таблицы.
В следующих публикациях Вы узнаете - что с приходом МИДИ все это можно делать по другому. 
## 2.5. MIDI CHANEL MESSAGE или «Новая почта» внутри PSR-a.
«Где деньги, Зин?» В.С. Высоцкий, песня «В цирке»
Если Вы внимательно читали последние пять абзацев предыдущего раздела 2.4. то могли заметить, что слова <MIDI команды> здесь нигде не упоминались. Под Вашим руководством, с панели управления, Все «делалось компьютером», своими внутренними командами-инструкциями формат которых нас действительно не очень интересует, хотя не исключено, что некоторые из них могут совпадать или быть похожими на MIDI. 
Так все и работало еще до MIDI – кнопочками на панели управления - выбираем заводское (или задаем свое) значение для любого доступного параметра, любого функционального блока инструмента, - записываем его в нужную ячейку памяти (ну это не совсем мы, а компьютер), а потом включается «тупая программа», которая всегда из одних и тех же адресов считывает очередной комплект настроек (Setup) и заставляет «синтезатор» выбранной Multi Part (или любой другой блок у которого есть доступные для регулировки параметры) выдавать нужный Voice с нужными обработками, эффектами и т.д. 
Но где же тут MIDI ? Ведь и таблица называется
«MIDI Parameter Change Table!»
Посмотрите пожалуйста в таблицу, на строку по адресу
08 00 04 там живет параметр <Rcv CHANNEL > <Приемный Канал> (значение от 1 до16). Ничего не напоминает? 
Это номер приемного MIDI канала, назначенного на данную Multi Part.
Я не могу этого проверить, но точно знаю, что до изобретения MIDI такой строчки в таблице не было! Собственно и публичной «открытой» таблицы не было!
<Rcv CHANNEL > Это и есть «ключик к дорожной карте», по которой стандартные внешние или записанные в файл МИДИ команды будут доходить до своей Multi Part .
Ребята из ММА не соврали – внутренняя доработка инструментов была не из грандиозных.
Кто не знает ММА – вернитесь к началу Глава 1, найдите там что то типа: … «были созданы: а) единый машинный язык команд для управления а так же …» 
По стандарту, они называются не команды, а
Сообщения о МИДИ Событиях. 
Midi Message - Миди Сообщение и 
Midi Event - Миди Событие.
Откройте нашу любимую < Data List > книжечку, и найдите в ней табличку под названием
MIDI CHANEL MESSAGE (1)
В первом (левом) столбике перечислены Midi Event - Миди События а справа показано как на МИДИ языке будет выглядеть Midi Message - Миди Сообщение о этом событии.
Сообщение состоит из двух частей Заголовок-байт = Status Byte и 1 или 2 Байта Данных = Data Byte.
Найдите там, где то в конце таблицы, уже знакомое Midi Event < Program Change >.
Я бы называл его более интуитивно, например < Сменить программу на номер XX… >
Реальное Сообщение о событии «Заменена программа на номер 48» ( 48-это Strings) написанное на МИДИ языке выглядит как [ Cn 30 ]. 
Где C(Н) – Статус, который собственно и присвоен команде
< Program Change > ( С - это не буква, это тоже Цифра!)
30 (Н) – это десятичное число 48 только записанное шестнадцатиричными цифрами. Так короче и удобнее записывать двоичные <Binary> числа (это те где существуют только 0101 1110). На самом деле, где то там в глубине «души» , компьютер общается только с двоичными числами. Для него все упростили до минимума! 
Представьте себе «Таблицу умножения», в которой есть только две цифры 0 и 1. О чем там можно «думать»? …. «Шарик! Ты балбес!» 
В любимой книжечке есть табличка перевода чисел десятичных «человеческих» Decimal в шестнадцатиричные Hexadecimal и в двоичную Binary систему. Называется она <MIDI Data Format>. О ней будет чуть позже.
Табличка <Voice List> c перечнем Номеров банка и MIDI Program Number на все Voice Вашего инструмента тоже есть в этой книжице.
При пользовании таблицами будьте внимательны и во избежание ошибок, обязательно проверяйте в какой системе записаны цифры которые Вы сейчас читаете! Часто (но не всегда!) в описаниях для уменьшения путаницы, после чисел записанных в шестнадцатиричной Hexadecimal системе может стоять буква-суффикс (H). В реальных МИДИ сообщениях (командах) используется только шестнадцатиричная система цифр 0 1 2 3 4 5 6 7 8 9 A B C D E F. И эти цифры всегда только парами. В такой паре цифр содержится минимальный квант информации - Байт (Byte). Об этом подробнее тоже будет чуть ниже.
Вернемся к теме. Все не очень сложно!
Обычно, после такой фразы, на третьем абзаце, книгу закрывают … навсегда!
На самом деле, «это просто как угол дома» на котором висит табличка с его №.
Если вместо <Strings> нужно включить <Sax Tenor> (из того же банка) то Номер банка менять не нужно, достаточно всего лишь послать 2-х байтовое сообщение <Program Change> вида < Cn 42 >. Если нужен <Sax Tenor> из другого банка, то вначале подается команда сменить № банка а затем все та же < Program Change> вида < Cn 42 >. 
Остается не ясным один вопрос : кому (какому из 32 синтезаторов, или какой из <Multi Part> адресуется эта команда?
Вот тут и вступает в работу, упоминавшийся выше, параметр < Rcv CHANNEL >, живущий в памяти по адресу 08 00 04 : 
< Midi Chanel > - это специальная метка прикрепляемая к Стандартному МИДИ сообщению. (Это номер на углу дома!) По № на метке компьютер сортирует поступающие команды и отправляет их на ту < Multi Part > (на тот синтезатор) за которым закреплен указанный на метке номер приемного Midi Chanel. 
Сообщения с «биркой» номера МИДИ канала называются Канальные или MIDI CHANEL MESSAGE.
В случае с нашим сообщением < Program Change > [ Cn 42 ] n-это и есть номер МИДИ канала. 
Номер < Midi Chanel > в канальном Midi сообщении и тот номер, что записан в таблице <Multi Part> по адресу 08 00 04 т.е. параметр <Rcv CHANNEL > должны совпадать, иначе «письмо уйдет по другому адресу».
Почтальон не несет ответственности за …..(Из «Устава связи СССР»).
Компьютер «сообразит» что 2 байта [ C0 42 ] это Канальное сообщение,
Статус С0 - это команда < Program Change > с биркой Chanel 0 (Канал №1).
Правильно адресованная МИДИ команда < Program Change > [ C0 42 ] будет направлена на синтезатор < Multu Part 00 > потому что, именно за ней (по умолчанию), был закреплен МИДИ канал 1# < Rcv CHANNEL 0 > . В результате новое число [ 42 ] будет записано в ячейку по адресу 08 00 03 которая отведена для хранения параметра < PROGRAM NUMBER >. Проверьте по таблице Ф.И.О. и адрес получателя, и скажите - каким Voice теперь должен играть синтезатор
< Multu Part 00 >.
Финал, не спеша, «с уважением», прочтите следующую фразу: 
«Канальное МИДИ сообщение [C0 42] «зашедшее с улицы или из SMF файла», сработало так же как (не известная) внутренняя команда от кнопочки с панели управления.»
Coda: Именно этого и добивались ребята из ММА!!! Так была организована и вот уже 36 лет работает «Канальная доставка МИДИ сообщений». 
Дальше 2 такта Пауза. Пауза это тоже музыка! 
#### 2.6. Немного из теории кодирования МИДИ сообщений
Эта глава была написана позже и просто вставлена в старый текст. Поэтому, получились перекрестные повторы. Извините! В нотной партитуре повторение встречается еще чаще, (особенно, если платят по-тактово !).
Думал, что не стоит об этом писать! В интернете есть много «ЛикБез»-ов по МИДИ и основам информатики, но судя по задаваемым вопросам, пусть «Букварь» тоже будет здесь.
Для понимания следующего раздела не мешало бы самим освежить в памяти - хотя бы азбуку цифровой информации: бит, байт, двоичные, шестнадцатиричные, десятичные числа!
- Что, скучненько?
- Ну-у-у…Та-ко-о-оо-е! …
Yamaha предвидела «та-ко-о-оо-й» ответ! 
Ищите в любимой книжечке таблицу:
<MIDI Data Format>! 
В таблице во всех трех столбиках записана одинаковая, нарастающая (по единичке) последовательность чисел, но записаны они в трех разных цифровых системах. Т.е. это Таблица - переводчик. В названии системы уже сразу сказано - сколькими разными цифровыми символами она пользуется. Это все «Позиционные системы» записи чисел. В них Вес или Значимость цифры зависит от ее позиции (разряда) в числе. 
На примере десятичной системы: 00 01 02 03 04 05 06 07 08 09 10 11 …..
Как только в младшем (правом) разряде значение доходит до самой «старшей» цифры 9, разряд обнуляется а слева, в старшем разряде, добавляется единичка. На второй позиции, она «весит» уже не единичку а десяток, единичка в третьем разряде это уже сотня и т.д. Цифры «десять» в десятичной системе не существует. Для записи величины (числа) «десять» придется использовать две цифры 1и0.
Под это правило попадают все числа во всех 3-х столбиках. Пользуясь такими же правилами записи чисел, Вы можете легко придумать свою «Позиционную систему» записи чисел с использованием например всего 5-ти цифр 0 1 2 3 4.
Попробуйте продолжить 00 01 02 03 04 ….ХХ
Теперь еще раз посмотрите на таблицу «с некоторым пониманием» того, почему двоичные числа такие длинные а шестнадцатиричные даже «компактнее» чем десятичные, а так же почему в двоичной системе нет цифры 2 а в шестнадцатиричной нет цифры «шестнадцать».
Возвращаемся к таблице-переводчику.
Столбик «Decimal» - Без коментариев!
В столбике <Binary> все числа длиной в 8 цифр, или 8 разрядов, или 8 «Бит» < Bit >. Старший (восьмой) бит - слева! 
Восемь «Бит» это и есть один «Байт» <Byte>. Каждый «Бит» может принимать только два значения 0 или 1. Других цифр в двоичной <Binary> системе и нет! 
«Байт» это минимальная единица (слово) цифровой информации, под которую выделяется одна ячейка памяти с персональным адресом. Размер памяти тоже измеряют Кб. Мб, Гб, Тб. Каждая новая приставка больше предшествующей в 1000 раз.
Слышу из зала: «ЭТО МЫ ЗНАЕМ!»
От автора : Поэтому 1 Терапевт = 1000 Гигапевтов!
Пользоваться двоичными числами, в виду трудности восприятия их огромных визуальных (письменных) размеров не удобно. Нашли простой выход – Байт = 8 Бит условно «разбивают» на две четверки (2 полу-байта) и каждую из них очень даже удобно записать лишь одной цифрой но только уже в другой - шестнадцатиричной системе!. Что Вы и видите в столбике <Hexadecimal>. 
Здесь все числа длиною всего в 2 цифры, или 2 разряда.
Каждый разряд числа может принимать значение: 
0 1 2 3 4 5 6 7 8 9 A B C D E F. 
В этой системе так выглядят 16 цифр. Здесь уже существует «цифра десять» это « А » но нет цифры «шестнадцать». В нашей привычной 10 цифр . (см. столбик «Decimal» или Арифметику для 1-го класса). Запись двоичных чисел в шестнадцатиричной системе намного компактнее. И что не мало важно: компьютеры почти с первого дня своего рождения, были «обучены» воспринимать побайтовую информацию записанную шестнадцатиричными цифрами. Это програмисты, для экономии бумаги и чернил, уже для себя лично постарались.
Таблица, заканчивается на числе 127 = 7F = 0111 1111
Следующее за ним должно быть 128 = 80 = 1000 0000
За ним 129 = 81 = 1000 0001
Но, их там нет! Числа 80(H) и 81(H) … будут уже из другой таблицы! А ЭТА таблица называется <MIDI Data Format> или «Формат МИДИ данных». По МИДИ стандарту, «Байт» МИДИ данных, т.е. байт, в котором (в двоичном виде) «зашифрованы» именно данные, имеет отличительный признак -. в нем старший 8-й «Бит» всегда Ноль! Если в «Байте» старший Бит не 0 а 1, это уже не байт данных а Байт Статуса. 
Старший 8-й «Бит» в байтах данных не является информационным а используется как идентификатор «типа» Байта. Поэтому с помощью одного 8-битного «Байта данных», в котором только семь 7-бит «рабочих», можно записать число не более чем десятичное 127 = 7F = 0111 1111. Вот на нем таблица и закончилась! Это и будет максимальный размер МИДИ данных (максимальная величина) которую можно записать одним байтом. Среди МИДИ параметров очень много таких у которых Диапазон значений лежит от 0 – до 127 или 00 -7F. (см. любую табличку в Любимой книжечке). Если нужно записать большую величину - то используем несколько Байт данных.
Из предыдущего абзаца автоматически выплывает «Вторая часть Марлезонского балета».
Становится понятным - почему Байт Статуса может начинаться с числа не меньше 
80(Н) = 1000 0000 и естественно, не может быть больше числа FF(H) = 1111 1111. Потому что - только у этого диапазона чисел старший 8-й «Бит» равен 1. 
Формат написания и Размер (количество байт) каждого Канального сообщения закреплены в МИДИ стандарте (см. таблички MIDI CHANEL MESSAGE (1)(2) и естественно в памяти компьютера инструмента. Это каждый раз «подсказывает» ему сколько Байт Данных нужно ожидать после получения Байта Статуса. «Не промахнись, Акела!»
Если в SMF подряд нужно записать несколько сообщений с одинаковым Байтом Статуса, для сокращения длины Миди сообщений и более быстрой обработки команд, МИДИ стандарт предусмотрел прием называемый «Коллективный (групповой) статус».
Например: МИДИ сообщение 92 40 64 44 62 47 62 4B 60 
Расшифровка: 
Произошло 4 однотипных события, каждое с Статусом 92 «Нажата Нота по каналу №3». (т.е. был взят Мажорный септ- аккорд из 4-х нот) и все 4 ноты (40 44 47 4B) каждую с своей громкостью (64 62 62 60) должен «сыграть» синтезатор <Multi Part 02> потому что за ним, в оперативке, по адресу 08 02 04 (ранее) был закреплен Rcv Chanel 02. Развиваем дальше…. Он будет играть эти ноты инструментом Voice < Grand Piano > потому что по адресу 08 02 03 (по умолчанию) прописан <Program Number 00 >. И т.д. можно по таблице начиная с адреса 08 02 00 и до « упора» рассказать что должен будет делать синтезатор от <Multi Part 02>.
При этом групповой статус-байт передается только один раз, в начале группы сообщений, а далее только байты данных от всех 4-х сообщений т.е. 2 х4 = 8 байт данных. Получив Статус с меткой МИДИ Канала №3 «компьютер» переключается на управление синтезатором <Multi Part 02> и будет «подключен к нему» пока не придет новый статус. Он знает, что у статуса 92 восемь байт данных подряд не бывает на самом деле это 2-х байтовые данные из четырех сообщений с одинаковым статусом 92. Акела не промахнется! (Не должен! )
Применение «Коллективного статуса» при записи не обязательно, и это на усмотрение разработчика секвенсора. Но чтение – обязательно, поскольку это входит в стандарт SMF.
И еще одна особенность - В Байтах Статуса <Канальных сообщений> каждая из двух цифр байта это отдельный параметр. В отличии от Байта Данных, их не нужно читать и воспринимать как одно число.
Например: Статус байт 93(Н) = 1001 0011
В нем 9(Н) =1001 это собственно и есть статус сообщения «Нажата Нота»
а 3(Н) = 0011 это канальная метка МИДИ канала №4.
Расхождение в одну единицу (3 и 4) возникает из за того, что цифра ноль в МИДИ, тоже является информативной. Мы давно слышали - что есть 16 МИДИ каналов. Но, в этой системе исчисления еще и 16 цифр. Такое совпадение - не случайно! Все очень логично. Каждому каналу отдать одну цифру, (начиная с нуля). Всем хватило! При этом номер любого канала состоит всего из одной цифры – и это всегда уместится в 4 бита (полу-байт), и это экономно, удобно а значит и рационально! Но «на практике», Вы никогда не услышите фразу: « Сообщение было передано по Нулевому Каналу.». На практике мы говорим по «первому», хотя в письме стоит цифра < 0 > Ноль, или говорим по «шестнадцатому» хотя в письме стоит цифра < F> а это ведь «десятичное»15 ! 
Существует и обратная коллизия. В привычной, десятичной системе используют 10 цифр, но вы не найдете на улице дом с № 0 и по этому, у всех первых девяти № дома из одной цифры (1 2 3 4 5 6 7 8 9) а у десятого № 10 уже из двух цифр. Мы не испытываем из-за этого больших неудобств. Так по-разному сложилось в информатике и в быту. 
«Но… как то - не ровненько, Доктор!»
P.S.
Это иногда приводит к еще одной путанице в МИДИ но, уже казалось бы в обращении с совершенно обычными, десятичными числами.
Например:
В одном банке Вашего инструмента может быть до 128 Voices. Но, что бы включить 128-й Voice, нужно послать двух- байтовое Канальное Сообщение < Program Change > формат < Cn 7F > где 7F это номер программы. Но 7F = 0111 1111 = 127# десятичное (см. все ту же Табличку).
В некоторых DAW, в «Програмных секвенсорах», возможен ввод данных в МИДИ сообщения прямо десятичными цифрами. Но есть переключатель : «Как будем вводить?» 0-127# или 1-128# при этом реально в миди сообщении всегда будет записано 00 -7F(H).
#### 2.7. MIDI CHANEL MESSAGE Продолжение
В таблицах MIDI CHANEL MESSAGE (1) и MIDI CHANEL MESSAGE (2) приводятся перечни и форматы написания канальных сообщений которые принимает а так же генерирует и передает «на улицу» Ваш инструмент. 
В любом сообщении присутствует два типа информации, которую нужно донести до потребителя:
Первая инфо - о каком управляющем событии (измененном параметре, выключателе, регуляторе, состояние клавиши и т.п.) идет речь, это важно для определения куда его дальше направить.
Вторая часть сообщения – это собственно сами новые данные о величине этого параметра.
За первую часть отвечает первый байт сообщения. Он называется байт Статуса.
За вторую - остальные байты это байты Данных их в сообщении может быть несколько.
МИДИ использует протокол последовательной (Serial) передачи данных. Что-то типа USB, только с намного меньшей скоростью передачи. Именно то, что и USB и MIDI используют последовательный порт, позволяет использовать USB порт компьютера в качестве МИДИ порта, после установки специального драйвера. Последовательный порт - это когда сообщения перед передачей, «выстраиваются в очередь», передаются по-байтово, (на самом деле, каждый Байт передается по-битово) только по одному, одно за другим, за частую сплошным потоком без пауз! 
На приемном МИДИ устройстве, что бы понять что это и кому пришло, из отдельных бит собирают байт, из байт приходится обратно собирать исходный полный текст сообщения. А это все время и естественно «задержки». 
Чтобы компьютеру в потоке байт, приходящих по МИДИ кабелю, «не париться» в поисках « Где закончилось одно и начинается другое сообщение? », разработчики стандарта максимально упростили процесс идентификации байта: «Статус или Данные?»
В байте Статуса, старший (восьмой) бит должен быть всегда единичкой а в байте данных всегда ноль. Поэтому, в байте Статуса, в качестве первой (старшей) цифры могут быть использованы только 8-9-A-B-C-D-E-F. Вторая цифра в байте Статуса (занята под номер миди канала) и может быть от 0 до F.Как раз и есть 16 цифр – 16МИДИ каналов.
В байте Данных (см. таблицу MIDI Data Format) обе цифры используются для обозначения величины параметра, но старшая (первая слева) цифра не может превышать 7 поскольку 8 это уже не данные это уже статус. У байта данных диапазон значений от 00 до 7F (H) или от 0 до 127 если перевести в десятичную систему. Если нужно передать значение больше чем 7F (H) =127 то используют несколько байт данных но каждый не может быть больше чем 7F (H).
Компьютер проверяет каждый принятый байт, а точнее, лишь одну цифру старший (восьмой) бит в каждом байте. И вариантов может быть только два! Как только попалась 1 – это байт статуса, далее пришло 2 байта у которых вначале не 1 а 0 – это байты данных поступившего сообщения. Затем опять пришел байт с первой 1. Это уже новое сообщение. Значит предыдущие 3 байта собираем вместе, это и было полное одно сообщение. В соответствии с Статусом и номером миди канала оно попадет на нужную <Multi Part>.
Статусов (т.е. типов) Канальных сообщений не много:
8n 9n Bn Cn Dn An En Каждый закреплен за определенной командой или группой команд. Подробнее см. таблицы MIDI CHANEL MESSAGE (1) и MIDI CHANEL MESSAGE (2). 
Из всех канальных сообщений в МИДИ файле чаще всего встречаются парные сообщения Note ON/Note OFF о самых понятных музыканту событиях:
Статус 9n Нажата нота № и затем Статус 8n Отпущена (таже) нота №. 
Это 3-х байтовые команды. В каждой из них (кроме статуса) есть 2 байта данных в которых закодированы 2 параметра: это Условный номер ноты и скорость ее нажатия/отпускания. Второй байт данных - скорость (Velosity) на прямую связан с громкостью. В МИДИ стандарте весь музыкальный диапазон нот (более 10 октав точнее 128 полутоновых ступеней по высоте) привязан к номерам клавиш. (см. рисунки и таблички в любимой книжечке) № ноты (клавиши) это второй байт после статуса (пара цифр) в команде. В МИДИ файле, эта популярная пара сообщений может выглядеть например так - сначала сообщение 99 24 64 и через некоторое время 89 24 00. 
Расшифровка: 99 24 64 (Н) 
99(Н) это нажата клавиша № 24(Н) то же что и децимальное 36, тоже что нота С1 = До 1-й октавы. скорость Velocity (64(Н) = 100 децим. (это громкость) ноты.
Расшифровка: 89 24 00 (Н)
то же, только первый байт 89(Н) это нота (клавиша) отпущена. Параметр Скорость отпускания ( обычно 00) и не принимается к сведению. 
В качестве команды Note OFF вместо 89 24 00 (отпустить 24-ю клавишу) может использоватся команда 99 24 00 (опять нажата 24 но со скоростью 00). Данные о том, понимает ли Ваш инструмент оба типа сообщения Note OFF, можно найти в Любимой книжечке в самой последней табличке с названием <MIDI Implementation Chart >.
Статусы 99 и 89 - оба сообщения переданы по МИДИ каналу 9(Н) . На привычном нам языке это 10-й канал (первый канал обозначается как 0 (Н) ноль) . Обычно МИДИ канал10 по умолчанию прописан за <Multu Part > синтезатором, назначенным для игры барабанами. Если в приведенном примере, 10 канал это Ямаховские барабаны, то Нажата нота (клавиша) № 24(Н)=36децим означает <Kick> удар по <Большому барабану>. Раскладку барабанов по клавишам см. в любимой книжечке таблица <Drum/key Assignment List >.
Длительность ноты в МИДИ не кодируется, она для каждой ноты вычисляется как разница по времени между двумя командами Нажата/Отпущена Нота.
Статус < Fn > не принадлежит к канальным сообщениям, т.е. здесь < n > это не номер МИДИ канала.
Я думаю, Вы уже поняли, что МИДИ канал это не железка в PSR-е и не провод в МИДИ кабеле, как его обычно рисуют, а всего лишь вторая цифра в первом байте канального сообщения! (Попробуйте, по-памяти, сами произнести эту фразу 2 раза !)
И нужна эта цифра только почтальону. Ведь на самом деле, лишь по одной паре проводов в МИДИ кабеле, в перемешку (но по очереди и по-одному) могут идти самые разные канальные сообщения адресованные на все 16 <Multu Part> . По умолчанию, номер МИДИ канала и номер <Multu Part > совпадают, и у каждой <Multu Part > обычно свой персональный номер приемного Midi Chanel.
Тест-вопрос для того кто тянет на «продвинутого» 
А что если одинаковый номер < Rcv CHANNEL > прописать за несколькими <Multu Part >? Подсказка: попробуйте представить: как каждая из трех <Multu Part > для которых в таблице по адресам 08 00 04 08 01 04 08 02 04 прописан одинаковый номер 01(Н) приемного МИДИ канала, отреагируют на Канальное сообщение < Нажата нота «Соль» > переданное по 01(Н) каналу.
Только что мы разобрались с тем что такое и как работают Midi Chanel Message. Это стандартизованные МИДИ сообщения. Все они входят в стандарты GM, GM2, GS, XG. Если при создании МИДИ файла использовались только стандартные команды, то это гарантирует корректное его (файла) воспроизведение на любом инструменте поддерживающем указанные стандарты.
#### 2.8 . Другие Разновидности MIDI MESSAGES
##### 2.8.1. MIDI SysEx MESSAGES
В предыдущих публикациях было рассказано о «классических» стандартных Канальных МИДИ сообщениях. Поскольку они Стандартизованы то их понимают все инструменты поддерживающие стандарт - формат GM GM2 и их производные XG GS.
Существует еще один, достаточно большой и более сложный по формату и написанию, тип МИДИ сообщений которые называются Эксклюзивными Системными Сообщениями или SysEx. В большинстве своем они не стандартизованы, но есть и универсальные т.е. не привязанные к конкретным производителям или моделям. Тем не менее, сам Формат их конструирования и написания прописан в MIDI стандарте, подробнее можно познакомиться во все той же «Data List» в разделе таблиц SYSTEM EXCLUSIVE MESSAGES.
В общем виде SysEx выглядят как F0 ID ID ID dd dd dd dd …F7
Где F0 = Exclusive status – голова сообщения 
F7 = End of Exclusive – идентификатор конца SysEx сообщения 
ID ID ID = 3 обязательных идентификатора типа события. Это уже байты данных т.е. они могут быть лишь в диапазоне от 00 до 7F.
dd dd dd … = данные, их количество (длина) не нормируется и может указываться в самом сообщении.
Первый из ID – обязательный идентификатор компании производителя (автор-создатель) SysEx. Этот ID присваивает MMA.
Например: 
41- Roland 42 - Korg 43- Yamaha 
ID = 7E и 7F – отданы под универсальные SysEx т.е. те, которые должны принимать все ( кто может).
Два (или более) последующих ID - тип события по собственной идентификации каждого производителя.
Одно и тоже число, стоящее на разных позициях в ID будет обозначать разные вещи.
Мы будем иметь дело с Yamaha SysEx 
типа F0 43 ID ID…dd dd dd …F7
SysEx сообщения (System Exclusive Messages) обычно, не имеют привязки к МИДИ каналу, (т.е. не расходуют «канальные метки» или не занимают МИДИ канал) поскольку, в большинстве своем, изначально использовались в качестве команд управления «специфическими, или обще системными блоками » инструмента. 
Адресная привязка команды к блокам (узлам) и конкретному параметру блока инструмента осуществляется за счет комбинации идентификаторов и/или прямой адресации памяти. Это когда адрес ячейки памяти, к которой обращается SysEx, входит в состав dd dd dd … самого сообщения. 
Например: см. Табл. System Exclusive Messages 
Столбик /MIDI Event/ команды переключения (выбора) секции стиля и Задания темпа стиля (авто аккомпанемента)
F0 43 7E 00 ss dd F7 Section Control
F0 43 7E 01 t4 t3 t2 t1 F7 Tempo Control
Оба сообщения имеют второй ID = 7E = Style. 
Третий идентификатор 00, 01, 02, 03 это уже привязка к конкретному параметру стиля.
Для тех, кто уже не «чайник» но еще не «хакер».
Если Вам попадется не знакомый SysEx с заголовком F0 43 7E ID … можете с умным видом произнести для публики :
«Он Ямаховский! И наверняка касается Стиля!»
Глядя на SysEx (вернее всего лишь на его второй байт ) в не знакомом SMF файле, можно по идентификатору ( 41 42 43 и т.п.) определить на каком или для какого инструмента (Roland Korg Yamaha и т.п. ) он создавался. Обычно, именно на «родительском» инструменте он сразу (без редактирования) и будет звучать наиболее корректно.
Чужие SysEx инструмент не распознает, они ни кому не мешают если стоят в голове файла т.е. до такта в котором начинаются ноты. Разве что место занимают. Их не обязательно удалять. Мне встречались SMF файлы с SysEx 41 и 43 одновременно. И они отлично звучали без какой либо редакции как на Roland GS так и на Yamaha XG инструментах (в том числе и партия барабанов!)
Yamaha не была бы Ямахой, если бы не придумала свой способ залезать в настройки работы <Multi Part> (да и любого другого блока инструмента) с помощью МИДИ, но при этом не пользуясь стандартными Midi Chanel Message. Вряд ли это ее авторское изобретение, но SysEx, которые позволяют это делать -100% Ямаховские.
У нас есть таблица с «расписанием памяти для XG инструментов». Вы помните – она стандартная, для всех Yamaha XG инструментов в части Адресов памяти. Yamaha разработала свой XG стандарт «раскладки редактируемой оперативной памяти» и к нему свои XG SysEx, которые позволяют напрямую обращаться к любому участку памяти этой таблицы по вопросам записи или чтения содержимого. См. Табл. System Exclusive Messages (XG). Там приведены 4 типа XG SysEx для общения с XG таблицей памяти.
Да-да! Кроме команды "Записать по адресу!" Есть XG SysEx команды запроса (Request) содержимого памяти по адресу (или по группе адресов Dump). Получив такую команду, Ваш инструмент сам тут же ответит SysEx-ом на SysEx. Знаешь MIDI язык – можешь поговорить с своим PSR! Это уж точно для «продвинутых».
Чаще всего мы будем использовать команду типа «записать по адресу XG таблицы».
У Ямахи такое SysEx Midi Event называется < XG Parameter Change >. Ее формат см. Табл.
F0 43 10 4C hh mm ll dd dd …F7 
Не вдаваясь в ID [43 10 4С] подробности
– < hh mm ll > это адрес из таблицы < MIDI Parameter Change Table> (hh- это старший, mm- средний и ll- младший байт адреса) а dd dd… это данные которые мы туда хотим записать. 
Поскольку, сообщения такого типа всегда имеют единый заголовок [ F0 43 10 4C ], на дисплее PSR в MIDI Event List в Song Creator вкладка SysEx заголовок [ ] опускается и выводится укороченное сообщение вида 
< XGPrm hh mm ll dd dd F7 >. 
По адресу (это первые три байта), пользуясь таблицей, можно «расшифровать» сообщение и узнать о каком конкретно параметре идет речь.
Пример1: 
Строка на дисплее XGPrm 02 01 20 41 01 F7 
Полный формат команды, или как она на самом деле записана в МИДИ файле, (или как будет выглядеть если мы откроем этот файл в обычном не Ямаховском секвенсоре)
F0 09 43 10 4C 02 01 20 41 01 F7 09 – это вспомогательное число размер (длина) сообщения (все что после F0 не считая и саму 09). Его PSR -й секвенсер дополнительно вводит в сообщение при записи файла. Это опять таки, чтобы компьютер еще раз проверил – не ошибся ли он с определением - где закончилось одно сообщение и началось другое?! Вроде бы все знают что конец это F7 ? Но вдруг…Акела промахнулся !
По адресам 02 01 20 (и 02 01 21) в памяти прописан параметр
( EFFECT1) <CHORUS Type >. Для него выделено 2 ячейки памяти <Size= 2> потому что в сообщении 2 байта данных [41 01] Hdec или тоже что [ 65 01] десятичными .
Если посмотреть еще в одну табличку c названием < Effect Type List / Chorus Type > то можно найти что [41 01] Hdec тоже что [ 65 1] dec обозначает пресетный Chorus Type под именем CHORUS 7.
Пример2:
На строке дисплея XGPrm 30 24 20 46 F7
По адресу в таблице <MIDI Parameter Change table> находим, что это имеет отношение к (DRUM SETUP Number 0) note number 24 parameter 20 (EQ BASS GAIN) и его величина вместо 40 (см. Столбик XG Default) теперь будет 46.
«А на словах, велел передать» , что по этой команде, для ноты №24 <Kick> (т.е. удар колотушкой ножной педали по <Большому барабану>), персонально «добавили низов»!
И теперь в Вашей ударной установке, на протяжении всего файла <Kick> будет звучать с «низами не по умолчанию».
##### 2.8.2. Барабанщикам «труднее всех» ведь они, одновременно, должны играть сразу на 20 инструментах…
Эта глава посвящена судьбе PSR MIDI Drummer.
Вернитесь к двум последним абзацам предыдущей главы.
Для начала, что такое (DRUM SETUP Number 0) – значит есть еще и Number 1.
Мы уже проходили, что в инструменте есть 32 <Multi Part> синтезатора. Любой из них может создавать любые звуки из перечня банков инструмента включая и барабанные (ударные звуки). Для этого ему нужно уметь работать в 2-x MOD ( 2-х режимах) см. таблицу <MIDI (XG) Parameter Change table> Adres 08 nn 07 <Part MOD> .
MOD <NORMAL> Voices - нормальный режим т.е. это синтезатор будет создавать звук «обычного» инструмента, у которого высота звука и строй звучания напрямую связаны с номером нажатой клавиши. 
MOD <DRUM> Voices т.е. когда новая клавиша меняет не высоту звука а целиком ударный инструмент.
Работа синтезатора в режиме <DRUM> во многом отличается от <NORMAL>, поскольку настройка «синтезатора» здесь задается не одним набором параметров для всей клавиатуры, а для каждой клавиши нужно загружать персональный семпл и свой (не стандартный) алгоритм его обработки. Режим <DRUM> Это другая реакция на команду <Key Off>. Большинство ударных звуков короткие и закончатся даже если вы не «отпустите клавишу». Но есть и такие (клавиша № 26 28 29 71 72 74) что звучат пока не отпустишь клавишу (например «Барабанная дробь»). Среди ударных есть инструменты, которые управляются не одной клавишей а связанной группой из двух или даже трех клавиш <Alternate Group>. Например группа клавиш № 42 44 46 управляет Хай-хетом. Нажимаем клавиши по-очереди и Открытый Хай-хет превращается в Закрытый или в звук Hi Hat Pedal и т.д. В общем - у PSR-барабанщика не все так просто.
Стандарт XG, выделяет два участка оперативной памяти (DRUM SETUP Number 0 и Number 1) для загрузки, хранения и редактирования данных настроек на каждый из барабанов двух различных <Drum Kit> (ударных установок). При этом, количество <Multi Part> синтезаторов, работающих в режиме MOD = <DRUM> Voices, т.е. занятых под барабаны может быть любым, но одновременно могут играть барабаны только из двух комплектов Ударных установок <Drum Kit> загруженных в оперативку инструмента.
По умолчанию (XG Default), все <32 Multi Part> включаются в режиме <NORMAL> и только < Part 10> в режиме DRUM. Для хранения и редактирования параметров < Part 10> (по умолчанию) выделяется память ( DRUM SETUP Number 0 ). Это область памяти с адресами от 30 0D 00 до 30 5B 2D. На каждую клавишу (каждый барабан) с номерами в диапазоне от 0D до 5B(Н) (от 13 до 91 = итого 78) т.е. на каждый из 78 ударных инструментов из одного <Drum Kit> выделяется память, где записаны доступные для редактирования до 20 параметров.
Для хранения параметров настройки второго <Drum Kit> выделяется память с адресами от 31 0D 00 до 31 5B 2D (DRUM SETUP Number 1) . 
Для более легкого запоминания: 
настройки для барабанов <DRUM SETUP Number 0> хранятся по адресам 30 ХХ ХХ 
а для барабанов <DRUM SETUP Number 1> по адресам 31 ХХ ХХ (Спасибо Ямаха!)
<Drum Kit> так же как и Voice, выбираются и загружаются в память <Multi Part> синтезатора с помощью Стандартных Канальных МИДИ сообщений, путем Ввода двух байтового номера банка Controle Change 00(H) и 32(H) и Ввода номера программы < Program Change>. Подробнее номера банков и программ для ударных см.табл Drum/key Assignment List.
Одновременно, для работы в PSR можно загрузить два <Drum Kit> естественно назначив их на разные <Multi Part> синтезаторы. Но при этом, для <Multi Part> номер <nn>, которая будет переведена из режима <NORMAL> в режим игры барабанами, в XG памяти по адресу 08 nn 07 <Part MOD> нужно прописать в какой из двух разделов «оперативной барабанной памяти» DRUMS1 или…2 (по каким адресам) ему обращаться, где находятся параметры настройки каждого барабана того <Drum Kit> с которым эта <Multi Part> будет работать.
Такие настройки можно постоянно видеть в Ямаховских SMF файлах, где для записи барабанных треков использовались готовые партии ударных из стилей. 
Напоминание: По стандарту SFF (Ямаха Стиль Файл формат) каждый стиль может иметь до 17 секций, в каждой секции стиля (Intro. Main. Fill In. Ending. Break) могут быть записаны нотные партитуры не более чем для 8 инструментов (8музыкантов) занятых в Авто Аккомпанементе. Ямаха их называет RHY1 RHY2 BASS CHD1 CHD2 PAD PHR1 PHR2
При использовании стиля в записи MIDI Song SMF по умолчанию, стилевые партии будут распределены за «Multi Part синтезаторами» с номерами от 9 до 16. При этом на 10-м канале будет записана основная барабанная стилевая партия т.е. та что в Стиле называется Rhytm2.
Для ударных инструментов в Ямаховских стилях выделены две партии Rhytm1 Rhytm2 т.е. синтезаторы занятые в этих партиях должны работать в режимах MOD <DRUM>. Остальные 6 в режиме <NORMAL> (как по умолчанию). По умолчанию,Yamaha пропишет основную партию Rhytm2 барабанов из стиля на 10-м треке. Там, в настройках трека, кроме выбора банка и программы (это выбор Drum Kit) можно больше ничего не прописывать.
Партия Второго стилевого <Drum Kit> (в стиле он называется Rhytm1 и обычно это перкуcсия 9 –й трек в SMF), будет тоже записана в файл, но в ней уже автоматически будут записаны выше упомянутые настройки. Если этого не сделать, (т.е. не записать команду Переключить синтезатор в режим MOD <DRUM>) то на 10 треке все будет ОК! Он и по умолчанию «барабанный». А вот партия барабанов на 9-м (или на любом другом) треке будет, в лучшем случае, играть звуками Piano!
Это было немного сложновато, и не только для барабанщиков. PSR-ному барабанщику не легче – он должен уметь играть одновременно на двух ударных установках, в каждой из которых может быть до 78 инструментов, и на каждый ударный инструмент есть до 20 параметров для настройки звучания!!! 
Информация к размышлению:
(78 х20) х2 = 1560 х 2Kit = 3 120 !!! Представляете Барабанщика, у которого есть 1560 ручек чтобы «испортить звучание» любой заводской пресетной ударной установки!? Ему (барабанщику) в PSR нужно больше всех оперативной памяти, а на сцене – больше всех места.
Браво барабанщик! Что бы ты так еще и играл то ….
«Не ругайте музыкантов! Они играют как умеют!» - @народная мудрость.
Часто, настройки типа <Part MOD> =NORMAL (для всех треков) и <Part MOD>= Drum (для 10), она (Ямаха) прописывает автоматом в голове файла. И это правильно! Хотя они там должны были появиться еще раньше - уже по команде «Включить режим XG».
Советы бывалого. 
По собственному опыту, рекомендую, при написании «головы» любого МИДИ файла (такт № 000) не лениться и всегда в начале записать команды по сбросу (и/или переходу в состояние по умолчанию) всех канальных < Multi Part > настроек, которые могли остаться в оперативке инструмента от воспроизведения предыдущего файла. А за тем, еще вручную, прописать все нужные настройки для каждого Вашего трека даже, если они совпадают с теми, что уже заданы командами типа установить« по умолчанию». Эта очень полезная привычка позволит Вам в дальнейшем сэкономить много времени. Для редактирования файла Вы всегда будете возвращаться к одному № 000 такту, где очень наглядно собраны вместе все настройки. Там тоже есть свои рекомендации и даже правила локации команд – что и за чем должно стоять. Многие команды, как и предусмотрено МИДИ протоколами, Ямаха не разрешает ставить «где захочу» и сама исправляет локацию не корректного ввода. Лучше всего посмотреть - как записаны «головы» у пресетных (заводских) SMF файлов и ориентироваться на них. 
То, что позволительно ставить «где хочу», обязательно ставьте в разрядку по времени т.е. с шагом от других команд в 15-20 тиков. А SysEx сообщения еще шире и с оглядкой на наличие «паузы» (свободного времени-места) после него, с учетом всех треков! У современных PSR этих «тиков» 1920 на одну четверть.
Еще Советы.
1. Можно заготовить себе Template т.е. стартовый Шаблон - файл для своих SMF (Yamaha так и делает) в который нужно будет только вставлять нужные цифры. Конечно же с Именами и телефонами автора, с указанием на чем писал и т.п. А что?!! Делать так делать!
2. Желательно, что бы все «прибамбасы» были введены в SMF файл по всем правилам МИДИ орфографии. Это несомненный респект автору!
Это делается с помощью еще одного класса MIDI сообщений. О них в следующей главе.
##### 2.8.3. META EVENT
С помощью стандартных Канальных сообщений, и не очень стандартных Yamaha SysEx сообщений, прописанных в MIDI файле, задаются все параметры настройки для каждой <Multi Part> занятой в Вашем SMF проекте. 
Существует еще один тип Midi сообщений, которые обязательно вводятся в каждый МИДИ файл, но их трудно назвать «сообщением о событии». 
Например: «сообщение о Тональности ( точнее о Ключевых Знаках)» Вашего Song
Или: слова текста песни – МИДИ файл может быть как «Караоке»
Или: сообщения о темпе или о размере такта Вашего Song.
MMA придумало им название < META EVENT> в переводе - что то типа Мнимые (Фиктивные) события.
Для знакомства с ними, откройте Любимую < Data List > книжечку и где то в самом конце найдите таблицу <Song Meta Event List>. 
Для стандартных <SMF Meta Event > (см. Табличку) их размер (длина данных) и правила написания естественно утверждает ММА. Они входят в перечень обязательных для понимания MIDI Meta событий.
Формат их написания больше похож на SysEx чем на Канальные сообщения. В общем виде это выглядит так:
FF ID len [Data ] (напоминаю- это все «шестнадцатиричные» цифры, каждая пара это Байт)
FF – это первый байт и естественно это байт статуса. 
Ранее я уже говорил что статусы типа Fn не имеют отношения к Канальным сообщениям. Вспоминаем:
F0 – это статус байт (первый) для SysEx Event
F7 – это последний байт в SysEx и вот еще- будьте знакомы 
FF - это статус (первый байт) для Meta Event – он там всегда первый.
ID – второй байт. Это идентификатор типа Meta Event. Это уже «данные» т.е. на второй позиции (и дальше) число может быть только в интервале 00 -7F.
Len (Lend) - третий байт это длина (размер) количество байт данных [Data ] в сообщении. Т.е. это сколько еще байт после len. Это опять в помощь компьютеру: «Не перепутай, Кутузов! Детям мороженое …»
Если в сообщении количество байт данных больше чем 127, (Lend больше чем 7F) то <len> это может быть не один а несколько байт.
ID = 7F закреплен за специальными (не стандартизованными) можно сказать «эксклюзивными» Meta Events. В связи с этим: Все не стандартные Meta Event , вне зависимости от их автора-производителя, должны иметь стандартный заголовок FF 7F len и дальше [Data]. А вот уже внутри [Data]… кто как себе придумал.
Ямахе всегда было тесно в рамках MMA стандартов, хотя она сама их разрабатывала: так GM очень быстро был расширен до XG , чуть позже SMF расширили до XF . В результате, кроме уже известных <XG Param Change>, появились 
<Yamaha Meta Event > (см. Табличку), среди них наиболее часто встречаемые имеют вид FF 7F len 43 73 ID ID [Data]
Там, в принципе, не нарушается стандарт: первые 3 байта это FF F7 len и дальше [Data]. А вот уже внутри [после len]… следующие 3 байта это «не очень Data», они больше похожи на идентификаторы, которые применялись в Ямаховских SysEx. (Посмотрите в таблицах <System Exclusive Messages> 43 73 это ведь Yamaha ID и Clavinova ID). А дальше уже идут собственно байты с данными. 
Позже появились еще и < Yamaha XF Meta Event >. (см. Еще одну Табличку).
< Yamaha XF Meta Event > конечно же имеют свой идентификатор – у них в голове всегда будут Типа 
FF 7F len 43 7B ID dd dd … парочка 43 7B это он и есть обязательный Yamaha XF идентификатор.
Meta Данные dd dd - это не обязательно цифры, с величиной какого- нибудь параметра. Большинство стандартных <SMF Meta Event > это вообще вспомогательные текстовые сообщения введенные в файл: название инструмента или программы на которой делалась запись, маркеры типа Припев/Куплет, авторские права на запись и т.п. Подробнее см.таблицы.
Совет. 
Еще раз посмотрите в табл. Song Meta Event List.
Первые 10 стандартных <SMF Meta Event> начиная с < FF 00….и до FF 09 …> MMA закрепила за разного типа текстовыми сообщениями но…каждому свое.
Не стоит вводить в файл информацию «о авторе и о том как «по-быстрому» он это набросал» простыми текстовыми <SMF Meta Event> типа< FF 01 len [Data] > TEXT 
или типа < FF 05 len [Data] Lyrics > последнее предназначено для ввода слов текста песни. Для сообщения о «Авторских правах на Шедевр» предусмотрено < SMF Meta Event > типа < FF 02 len [Data] Copyright >. 
Применяйте осмысленно – это лицо автора. Длинные тексты не увидеть на секвенсорах без горизонтальной прокрутки.
Стандартные <SMF Meta Event > на дисплее PSR обычно выводятся уже сразу на «человеческом» английском языке.
Например: SMF Meta Сообщение о темпе 
вида FF 51 03 B7 1B 00 на дисплее Song Creator/SysEx выглядит просто как <Tempo 500 >
Некоторые < Yamaha XF Meta Event > функционально, дублируют аналогичную Yamaha SysEx команду. 
Из собственных МИДИ экспериментов.
Я когда то был очень удивлен: 
С внешнего секвенсора (XG Works) по МИДИ кабелю на PSR передавались, 10 шт вручную записанных YamahaSysEx команд. Они были взяты конечно же из любимой книжечки
< Data List >. Это были уже знакомые нам
/ SySex/ Chord Control типа F0 43 7E 02 d1 d2 d3 d4 F7, задающие аккорды для игры включенным на PSR стилем Авто аккомпанемента. При этом, PSR был в режиме записи Real Time Song Record и его МИДИ вход был настроен на прием ChordSysEx. Все работало, стиль PSR-а играл по аккордовой гармонии, которая приходила по МИДИ кабелю, и одновременно писался Song. После этого, я воспроизводил записанный файл на этом же PSR.. Стиль играл по записанной в файл аккордовой последовательности, как и во время записи. Дальше было интересней!
1. Когда на PSR я открыл для просмотра созданный файл (Sоng Creator/ Event List вкладка SysEx) я не нашел там в записи ни одного знакомого, переданного с секвенсора, YamahaSysEx сообщения задающего аккорды ?! Но ведь все играет, и названия аккордов появляются на дисплее в нужном такте! 
2. Покопавшись, вместо них нашел с десяток < Yamaha XF Meta Event > 
Типа FF 7F 07 43 7B 01 d1 d2 d3 d4. Но внешний секвенсер ( XGWorks) такое не отправлял!
Любимая книжечка подсказала что
это < Yamaha XF Meta Event > Chord Name и более того,
d1 d2 d3 d4 (это кодировка аккордов см. таблицу) в них абсолютно совпадало с d1 d2 d3 d4 в составе сообщений Yamaha <SySex Chord Control > что передавались с XGWorks.
3. Почитал внимательней любимую книжечку, там оказывается написано, что для обоих типов сообщений Ямаха применяет одинаковую кодировку аккордов.
Ну это хорошо, при расшифровке меньше напрягаться и PSR и мне.
4. Когда этот (записанный на PSR) файл я перенес на внешний секвенсор (XGWorks) и попытался уже с его помощью, вновь от туда, по кабелю управлять, с помощью записанных аккордов, работой Авто аккомпанемента – ни чего не получалось! Запущеный на PSR стиль ни как не реагировал, на записанные команды с кодами аккордов которые читал и распознавал XGWorks. Правда, и МИДИ индикаторы входа на PSR ничего не показывали…
Выводы:
1. В PSR есть «переводчик» внешних команд <SySex Chord Control> в < Yamaha XF Meta Event > Chord Name, который включается в работу во время «записи с улицы» !.
2. Сообщения < Yamaha XF Meta Event > Chord Name не передается по МИДИ кабелю.
То что стандартные < Meta Event > не передаются через МИДИ интерфейс я знал – думал а вдруг Ямаховские, с Ямаховского (XGWorks) да на родной Yamaha PSR зайдут! Не сбылось! А вот на счет «переводчика» - это было открытие! 
Если записывать в файл аккорды средствами PSR (по-шагово или в реальном времени, способами описанными в Руководстве) то (в конечном итоге) они запишутся в файл только в формате < Yamaha XF Meta Event > Chord Name (никаких эксклюзивов!). Это понятно, иначе зачем вообще было придумывать свой XF формат, если им не пользоваться! Но читать PSR умеет и сообщения Yamaha SySex Chord Control хотя бы потому что они ведь все таки Ямаховские и еще, они передаются через МИДИ интерфейс!
Много DAW программ при создании SMF, по умолчанию, ставят в голову файла cообщения Tempo =120 / Beat {Time Signature}=4 / 4 / Key Signature = Am прописывая их в файле с помощью стандартных <SMF Meta Event>.
Ответы на пару популярных вопросов:
1. « Как бороться с тем, что < Song Meta Event > не передаются по МИДИ кабелю?»
- Ни как! 
Они живут и хранятся только в Song файле (Зри в корень! Т.е. читай название!) и если они важны – перенесите их на другое устройство вместе с файлом. 
Напоминаю, что на PSR-ах Yamaha «упорно» не позволяет самому писать или редактировать < Yamaha SysEx >, <Yamaha Meta> и <Yamaha XF Meta> сообщения. Некоторые из них она устанавливает в Сонг, нужно только научиться ставить их в нужную локацию. Среди них есть очень полезные, такие какими она сама (Yamaha) пользуется, их можно увидеть в пресетных Демо, но они туда были вписаны точно не на PSR. Он не умеет их вводить по команде исполнителя. Тут выход только один – дописывать их на внешнем секвенсере.
2. А как «они» МИДИ сообщения идут по кабелю?
-- Не бистро! – как говорил Д.М.Гоцман «к/ф Ликвидация».
МИДИ это «последовательный порт» да еще и очень медленный.
При передаче МИДИ сообщения по кабелю оно (сообщение) разделяется на отдельные составляющие байты. Каждый из 8 бит (в каждом байте) преобразуется в одиночный импульс тока стандартной длительности 32 мксек. На передающей стороне, перед тем как передать, к каждому байту, спереди и в конце, добавляют еще по одному служебному (старт/стопному) биту с «ноликом». По ним приемнику будет легче «распознавать» начало и конец байта в сплошном потоке. В результате, перед передачей, байт из 8-битного превращается в 10-битный, длиной в
32х10= 320 мксек. При такой длине за одну секунду через МИДИ интерфейс может быть передано около 3000 байт. Максимальная пропускная способность кабельного МИДИ соединения т.е. Скорость потока МИДИ данных
около 3 КилоБайт/сек. Это очень медленно и никак не подходит для передачи звука. (Сравните аудио потоки mp3 через тот же USB порт). В приемнике после распознавания байта, служебные биты отбрасываются. Принятые байты объединяют в исходное сообщение = Байт статуса + байты данных. И отправляют по назначению. На все это нужно время а значит не минуемы задержки.
Совет.
Каждое из канальных МИДИ сообщений само по себе - достаточно короткое 2-3 байта. Правда, если мы в процессе записи двигаем Фейдер громкости или (особенно) колесо Питч-Бенда, или Модуляции, то для МИДИ записи такого события (длительностью в пол секунды), 
«…а я чуть-чуть подвинул ползунок», 
может быть создано и подряд записано в файл до 100 шт однотипных «достаточно коротких» канальных сообщений, в каждом на единичку больше(меньше) параметр. Типа, «маленькими скачками - на слух звучит плавно!»
В цифрах по- другому нельзя! (Вспомните wav-ку с ее ступенчастыми семплами). А это уже серьезная нагрузка на МИДИ порт ! 
Если нужно просто увеличить громкость тихо записанного Баса начиная с 26-го такта – просто поставьте в нужной локации один контролер 11 Expression или в крайности 07Volume (хотя менять volum посреди песни это mauvais ton). И не стоит (без особой нужды) записывать «плавное увеличение громкости» двигая во время записи фейдер в микшере. В конце концов, можно сделать групповую редакцию - увеличив на 20% Velocity всех тихо записанных нот. 
В следующей главе разберем практические примеры использования Yamaha
SysEx Event. 
### Глава 3. Практика работы с MIDI
Общие принципы
Язык MIDI команд стандартизован и поэтому есть возможность применять его для управления инструментом (или целой группой инструментов) используя большой арсенал стандартных Chanel Message и (или) эксклюзивных SysEx и Meta МИДИ команд-сообщений.
Команды в МИДИ формате существуют за пределами процессоров муз. инструментов – они либо записаны в МИДИ файлах, которые читает МИДИ плеер инструмента, либо читаются или генерируются на внешних устройствах и передаются на МИДИ вход инструмента по кабелю.
У Ямахи есть свой подход к применению своих SysEx команд, который нужно учитывать при работе с МИДИ. 
1. Разные типы SysEx и Meta Events были разработаны в разное время для разных инструментов и предназначены для разных способов ввода их в инструмент. Одинаковые по действию и по названию будучи «эксклюзивными» для разных инструментов они могут иметь разный формат.
2. Стандартные <Chanel Messages> и Некоторые SysEx распознаются одинаково в не зависимости от того как их «загоняют» в PSR – через MIDI INPUT или в составе SMF MIDI файла. Но есть SysEX, которые распознаются и предназначены для использования только в составе Song файла, который нужно в PSR загрузить целиком, и их безполезно подавать с внешнего секвенсера по МИДИ кабелю на MIDI IN вашего PSR-a. Они дойдут по кабелю до MIDI IN Вашего PSR-а но там их никто не ждал (их нет в перечне допущенных) и на этом <КПП> их никто не распознает. В книжечке «DATA LIST» Вы можете найти такие в табличках <Song System Exclusive Message List> .
3. Надеюсь Вы помните что все типы SMF META, YAMAHA META и YAMAHA XF META Event по определению, не передаются по MIDI кабелю, по этому не могут быть получены через MIDI INPUT. Они читаются (и пишутся и живут там) только в SMF. В книжечке «DATA LIST» Вы можете найти такие в табличках <Song Meta Event List> .
4. В инструменте есть «переводчик» языка МИДИ на язык, понятный его «внутреннему компьютеру» и наоборот. Трансляция может быть « в обе стороны», на прием и на передачу, но не обязательно «равноправная» для всех МИДИ сообщений. Т.е. некоторые МИДИ сообщения принимаются (распознаются) и передаются (генерируются) самим инструментом, а некоторые только принимаются (и выполняются). Более подробные данные об этом можно отыскать в маленьких книжечках под названием «Data List» на последней страничке в разделе <MIDI Implementation Chart> на Ваш инструмент.
5. Если кроме стандартных, учитывать и SysEx сообщения, то на практике, инструмент обычно способен принимать и выполнять гораздо больше команд чем генерировать и передавать «на улицу». Благодаря именно этому свойству - с помощью МИДИ команд можно добраться до регулировок, которые недоступны с панели управления инструмента. Такие команды обычно выходят за рамки стандартных сообщений GM или GM2 . Чаще всего, они пишутся в формате SysEx, XG Prm SysEX или Yamaha Meta-Event. Знание их позволяет раскрыть и использовать полный потенциал инструмента .
В книжечке <Data List/MIDI PARAMETER CHANGE TABLE> на Yamaha XG инструменты есть подробное расписание адресов памяти и параметров которые там хранятся. Это исчерпывающий объем информации для того, чтобы с помощью Yamaha XG Prm SysEx сообщений управлять параметрами встроенных эффектов, эквалайзеров, DSP, и непосредственно управлять параметрами синтеза Voice в MULTI PART синтезаторах. Встроенный в инструмент [Voice Creator] на много облегчает эти задачи, автоматизируя процесс перевода команд редактирования параметров с «человеческого языка» на MIDI язык Yamaha XG Prm SysEx сообщений.
К сожалению, этого нельзя сказать о управлении Авто Aккомпанементом через МИДИ. Некоторые из команд-сообщений этой группы, приводятся в описаниях <Data List>. Некоторые - вообще отсутствуют хотя Ямаха более 35 лет использует их в каждой своей демо записи звучания стиля. Но, в большинстве случаев, даже для приведенных в <Data List> команд, нет инструкций как ими практически пользоваться и где брать переменные данные для их правильного написания. 
В настоящих статьях я попытался собрать накопленные за много лет данные о МИДИ командах, с помощью которых можно управлять работой Авто аккомпанемента и многих других блоков в Yamaha PSR инструментах. Здесь ответы на многие вопросы из серии: «Как заставить PSR делать еще много чего, сверх того, что доступно кнопками с панели управления ?». Или еще: - «Как команды, предназначенные для работы Авто аккомпанемента, могут управлять другими функциями инструмента?» и т.п. 
Данные собирались и накапливались из различных источников в том числе :
- Data List на иструменты Yamaha PSR, Tyros, Clavinova;
- подробный анализ Event List заводских Demo Songs с демонстрацией встроенных стилей;
- на просторах Интернета, на форумах и особенно на не официальных сайтах энтузиастов- пользователей Yamaha PSR, Tyros, Genos;
- методом проб и ошибок, переборов работы десятков вариантов Yamaha SysEx и Meta-Event.
Законный вопрос – Для чего это нужно и что это дало? Об этом читайте ниже.
Эпиграф:
«Все, что исполнитель делает вручную (кнопками, ручками, фейдерами, педалями или «тыча» пальцем в дисплей… ) в процессе подготовки и игре с использованием или без Авто аккомпанемента, и более того, можно заставить инструмент делать «без рук» - с помощью МИДИ сообщений.» 
В. Петренко. Избранное. около 2004 года
Опускаем стандартные процедуры подготовки любого инструмента к работе, а начнем сразу с тех, которые отличают Yamaha PSR от Yamaha не PSR-а. Это конечно же в первую очередь АВТО АККОМПАНЕМЕНТ. 
Для «живой работы» нужно: загрузить стиль, выбрать секцию стиля с которой начнем ACMP START, задать общую громкость стиля (STYLE BALANS) и откорректировать (при необходимости) громкость отдельных его партий (STYLE PART BALANS) , задать темп, задавать (менять) аккорды в нужной локации (000 000 0000) переключать секции стиля в нужной локации, в нужном такте поменять Voices на Panel Part R1 R2 L ….Все это и еще много чего PSR может делать вместо Вас, по МИДИ командам, записанным в SMF (Song файл). 
3.1. Как задать аккорд для Авто Аккомпанемента с помощью МИДИ сообщений.
Можно на МИДИ вход инструмента подсоединить внешнюю МИДИ клавиатуру, и в реальном времени (на живо), передавать с нее МИДИ сообщения о одновременно нажатых клавишах (т.е. взятых аккордах). Это стандартные, канальные сообщения типа <Note ON, Note OFF> при получении которых звуковой модуль обычного инструмента отзывается < Voice > назначенным на партию, управляемую по данному МИДИ каналу в точном соответствии с номером ноты (клавиши) и с переданной в сообщении динамикой (Velocity) нажатия на клавишу. Аккорд скорее всего прозвучит, но это ни как не повлияет на работу Авто Аккомпанемента, в какой бы части Внешней клавиатуры вы его не нажимали.
Современные Yamaha PSR клавишные инструменты, верхне-среднего и премиум класса имеют на борту не менее 32- <Multi Part> звуковой модуль. Для каждой <Multi Part> может быть назначен свой <VOICE> и выбран свой (произвольный или по умолчанию) номер МИДИ канала для приема управляющих МИДИ сообщений.
Вспомним из ранних статей.
Стандартные МИДИ команды-сообщения к которым прикреплена «бирочка» с номером MIDI Chanel называются КАНАЛЬНЫЕ. По номеру МИДИ канала «компьютер» сортирует поступающие канальные сообщения и направляет их на <Multi Part> за которой закреплен данный канал.
XGPrm SysEx сообщения доходят до <Multi Part> (или до другого адресата) немного другим способом. В составе такого сообщения обычно указывается постоянный, стандартный адрес памяти, закрепленный за каждым параметром каждой <Multi Part> пожизненно. Т.е. XG SysEx обычно, работают напрямую с памятью которая распределена за различными блоками инструмента <Multi Part> <Effect1> <Effect2> <Multi EQ> <A/D Part> и т.д. Подробнее см. <DATA LIST/MIDI PARAMETER CHANGE TABLE>. Во всех Yamaha инструментах, поддерживающих XG стандарт, ЭТИ АДРЕСА ОДИНАКОВЫ. SysEx сообщения не занимают (не расходуют) МИДИ канал. 
XG стандарт предусматривает до 120 управляемых по МИДИ параметров для каждой <Part>. Из них 108 обязательно задаваемых (по умолчанию или исполнителем). Подробнее см. <DATA LIST/MIDI Parameter Change table (MULTI PART)>. Такого количества реальных (фейдер, регулятор, кнопка) физических органов управления параметрами Voice, назначенного на одну Part (Партитуру) , нет ни у одного «железного» инструмента. Но с помощью МИДИ сообщений такое управление возможно!!!
Вряд ли кто то задумывался что стандартно записанное в начале каждого МИДИ файла коротенькое SysEx сообщение F0 43 10 4C 00 00 7E 00 F7 «Включить режим XG», или официальное название <XG Sistem ON> заставляет для каждой из 32 Multi Part все 108 параметров принять значение по умолчанию, а это значит поменять (задать) более 3200 значений за один прием!!! И еще я забыл, что кроме того, одновременно, эта команда задает по 40 параметров каждому из установленных на борту процессору эффектов DSP ! Возможности управления по МИДИ действительно уникальны! 
3.1.1. МИДИ настройки для задания аккорда управления Авто аккомпанементом нотами из которых он состоит
По умолчанию, приемные МИДИ каналы (а значит и все входящие канальные МИДИ сообщения ) распределены между первыми 16 Multi Part звукового модуля. Но ни одна из этих доступных (для канальных сообщений) Multi Part (по умолчанию) в PSR не используется для исполнения какой либо партии Стиля - Style Part. Те кто играют Стилевые Партии сидят во второй группе из 16 музыкантов. Что бы стандартные МИДИ сообщения «доходили до Авто Аккомпанемента» нужно «перенастроить» входной МИДИ маршрутизатор. «Серьезные PSR инструменты » позволяют это делать. 
В PSR, для внешнего (через MIDI INPUT) управления Авто аккомпанементом, предусмотрен особый режим настройки Входных (приемных) МИДИ каналов. Для этого нужно сделать некоторые назначения в режиме работы МИДИ приемника инструмента.
1. Задать МИДИ канал распознавания тоники (ROOT) аккорда. Для чего c панели управления зайти в FUNCTION/MIDI/All Parts/EDITE/ROOT-
Если для канала выбран режим ROOT - сообщения Note ON/OFF принятые по этому каналу будут распознаваться как тоника аккорда для секции аккомпанемента.
2. Задать канал идентификации типа аккорда. Перейти на вкладку <Chord Detect> и аналогично назначить канал. Сыгранные аккордом сообщения Note ON/OFF принятые по выбранному каналу, будут распознаваться как ноты аккорда для секции аккомпанемента. При этом, ноты тоники будут распознаваться с учетом установленной точки разделения клавиатуры, а аккорды будут распознаваться - соответственно выбранному на инструменте типу аппликатуры. Осталось только сохранить в инструменте созданный шаблон МИДИ настроек в виде Пользовательского (USER) ИМЯ.
Теперь можно подключить к МИДИ входу внешнюю МИДИ клавиатуру (или секвенсер с записанными нотами аккордов), назначить на них МИДИ каналы для передачи в соответствии с выбранными приемными каналами на инструменте. Выбрать и запустить на инструменте нужный стиль и управлять гармонией (аккордами) Авто аккомпанемента от внешнего источника нот. 
Не очень простой способ, но в результате позволяет раздельно управлять тоникой и типом аккорда.
С помощью МИДИ, можно заходить в управление Авто аккомпанементом на любой стадии процесса. Нужно только знать эти команды. 
Выше, мы рассмотрели, как задать управляющий аккорд, передавая ноты из которых он состоит. Далее Yamaha сама распознает (идентифицирует) аккорд – выводит его название на дисплей - и выполняет всю остальную работу так же как при обычной «живой» игре на собственной клавиатуре.
##### 3.1.2. Задание аккордов с помощью <SysEx> Event 
МИДИ позволяет «облегчить» инструменту задачу «Как распознать аккорд анализируя ноты из которых он состоит?». Yamaha придумала Эксклюзивные МИДИ команды < SysEx сообщения > а так же <Yamaha XF Meta Event> в которых пишется готовая кодировка типа и тоники управляющего аккорда для всех партий Аккомпанемента и еще в этих командах отдельно (дополнительно) можно задать тип и тонику аккорда для партии баса.
Если Вы чуть-чуть аранжировщик то знаете что они не всегда и не обязательно должны совпадать !!! 
SysEx события можно создавать и записывать на внешнем секвенсоре и передавать их через МИДИ интерфейс. (Meta Event через MIDI не передаются ! ). SysEx Формат этих сообщений описан в DATA LIST/SYSTEM EXCLUSIVE MESSAGES/Chord Control . 
Выглядит это так F0 43 7E 02 d1 d2 d3 d4 F7. 
Это Yamaha SysEx сообщение в котором 4 байта данных d1 d2 d3 d4 содержат информацию о управляющем аккорде. (Подробнее см. DATA LIST/SYSTEM EXCLUSIVE MESSAGES/Chord Control) К сожалению, встроенный в инструмент секвенсор (Song Creator) не позволяет напрямую по-байтово создавать и редактировать SysEx и Meta Event сообщения, (позже я расскажу как можно обходить и эту проблему) но их можно писать вручную на внешнем DAW. 
Удобнее всего это делать с помощью старенькой програмки Yamaha XGWorks - там можно по- шагово задавать аккорды «человеческим языком» а программа сама запишет их в виде Yamaha XFMeta Event которые, при необходимости, можно еще вручную продублировать с помощью SysEx например:
Аккорд Gm7/Bb в виде SysEx сообщения 
выглядит так F0 43 7E 02 35 0A 27 00 F7.
Эти сообщения, в Реал-тайм передаются через МИДИ интерфейс, тип принятого аккорда выводится на дисплей инструмента и далее все как обычно.
В настройках МИДИ приемника инструмента, естественно, должен быть разрешен (открыт) прием SysEx сообщений. 
SysEx сообщения не являются канальными и следовательно, не занимают (не расходуют) отдельный приемный МИДИ канал. 
##### 3.1.3. Задание аккордов с помощью Meta Event 
Можно задать аккорд с помощью Yamaha XF Meta Event Chord Name . XGWorks именно так и делает. У него на дисплее это выглядит как
XF Chord Name 43 7B 01 35 0A 27 00 .(выводятся только последние 7 байт).
Записанную на XGWorks аккордовую последовательность нужно сохранить в виде SMF и загрузить этот файл в Проигрыватель PSR-а. Это можно было сделать и на PSR в SONG CREATOR в режиме Step Record подробнее см. Руководство пользователя.
Аккорд Gm7/ Bb на PSR в SONG CREATOR/ вкладка SYS/EX виден в виде Meta FF 7F 43 7B 01 35 0A 27 00 
Meta Event (Фиктивные, мнимые, события) не передаются по кабелю через MIDI интерфейс, но включаются в состав MIDI файла, распознаются и выполняются инструментом в соответствии с установленной на нем XF Version ID. Т.е. для того чтобы Meta Event сработало нужно переносить на инструмент целиком SMF файл с прописанными в нем Meta Event (например на флешке) и воспроизводить его на SONG PLAYER PSR-a.
#### 3.2. MIDI Message STYLE Section Control 
При игре с Авто аккомпанементом исполнитель, кроме задания гармонии все время управляет сменой/ переключением активных секций Стиля (Intro, Main B. FillC). Эту работу также (причем более точно) могут великолепно выполнять MIDI SysEx команды, прописанные в нужном месте (локация) файла. Их формат приводится в DATA LIST/System Exclusive Messages/Section Control F0 43 7E 00 ss dd F7
Есть возможность, в нужном такте «заглушить» любую из партий стиля. Подробнее См. табличку Song System Exclusive Message List /Style/Style Part On/Off 
F0 43 73 01 51 05 00 00 08 dd dd dd dd dd dd dd dd F7 
Здесь 8 байт <dd dd dd dd dd dd dd dd> это 8 выключателей для 8-ми партий стиля dd=00=OFF 01=ON. Это всегда только «коллективная» команда т.е. если нужно выкл лишь одну партию стиля <Bass> то все равно нужно указать положение выключателей для всех 8-ми партий стиля. Пример: Данные <dd> для команды <Выключить Bass> будут выглядеть как <01 01 00 01 01 01 01 01>
Вместо заглушенной стиль- партии можно включить фразы из <Multi Pad> или в этом месте записать в Сонг - треке собственный вариант отключенной партии Стиля.
Можно даже записать в Сонг команду на полную смену стиля посреди песни. Нужно только знать формат этой команды и внутренние номера стилей для вашего PSR-а. См. Ту же табличку Song System Exclusive Message List /Style/Style No. 
У многих последних моделей PSR эта команда имеет вид
F0 43 73 01 51 05 00 03 04 00 00 dd dd F7 а вот где брать dd dd No стиля Ямаха умалчивает. 
Ни в одном Руководстве Вы не найдете таблицу где будет написано, что стиль <8BeatModern> в вашем PSR-e имеет внутренний номер <dd dd = 08 А6>. (Не пытайтесь использовать 08 А6 это номер для примера). 
Энтузиасты (и я в том числе) добывали эти номера примерно так: записать несколько Сонгов ( длиной 2-4 такта) разными стилями. А потом в Song Creator/ вкладка SysEx в каждом Сонге увидеть эту команду, найти в ней данные dd dd и «привязать» их к каждому Названию Стиля. Шансов не много! Эта SysEx команда длинная (14 байт) и если нет горизонтальной прокрутки, то на дисплее PSR dd dd может не уместиться. Что бы увидеть все придется смотреть файлы на внешнем секвенсере. Будет сложно самому - обращайтесь в Школу - здесь помогут.
Мы разобрались с основными рабочими МИДИ командами по управлению стилем: это те что могут:
Задать стиль No F0 43 73 01 51 05 00 03 04 00 00 dd dd F7 
Задать секцию стиля F0 43 7E 00 ss dd F7
Отключить/вкл Стилевую партию
F0 43 73 01 51 05 00 00 08 dd dd dd dd dd dd dd dd F7 
Задать аккорд в виде Meta FF 7F 43 7B 01 dd dd dd dd 
или в виде SysEx F0 43 7E 02 dd dd dd dd F7
Если Вы создадите свой SMF файл, в котором в нужных локациях будут стоять нужные вышерассмотренные МИДИ команды, загрузите такой файл в PSR MIDI Player, нажмете кнопку <SONG START> воспроизведение начнется, на дисплее будут выводиться и меняться аккорды, меняться номера тактов, в секции <STYLE CONTROL> будут переключаться лампочки-индикаторы MAINB-FILLB… но скорее всего Вы не услышите звука ни одной ноты стиля.?! А собственно почему должны звучать ноты? В этом файле ведь нет ни одного сообщения типа Nota On/Off. 
Тогда Почему не играет Стиль?? 
Берите помощь Зала! Оп-па-аа!
Команды не было!
Если при старте, кроме кнопки <SONG START>, Вы одновременно нажмете кнопку <STYLE START> все должно заиграть!! Если бы команду START записать в файл то-о-о-о…
С помощью МИДИ, можно заходить в управление Авто аккомпанементом на любой стадии процесса. Нужно только знать эти команды. 
Ни в одном Руководстве по PSR нет даже упоминания о том, как выглядит еще одна очень нужная пара команд, которую нужно подать на стадии запуска/выключения стиля.
Но МИДИ это то же умеет делать! Достаточно поставить в нужной локации SysEX
F0 43 60 7A F7 - START STYLE
F0 43 60 7D F7 - STOP STYLE
По уже не однократно упоминавшимся причинам, это можно сделать (вписать команды в SMF) только на внешнем секвенсере! И тогда, при воспроизведении Сонг-а, Стиль будет включаться сам в нужном месте Песни. Можно не вставлять команду - но тогда <Start Style> придется делать кнопкой вручную или стартовать синхронно двумя кнопками! (об этом уже было см. выше)
#### 3.3. МИДИ управление стилем без внешнего секвенсера.
Во всех современных PSR, Tyros, Genos в руководствах описываются по крайней мере два способа записи Song-a с использованием встроенных стилей это быстрый Qwik и по-шаговый Step Record. Дается достаточно подробная инструкция о том как это сделать. Здесь не будем на этом останавливаться. В обоих способах в конечном результате Вы получаете SMF файл в котором партии стиля полностью развернуты (EXPAND) в нотные партитуры, сыгранные по заданным аккордам, заданными вариантами разных секций стиля. 
##### 3.3.1 
В таком файле будет до 8 треков занято стилевыми партиями. Обычно это треки с № 9-16 и у Вас имеются еще 8 треков где можно записать собственные партии в дополнение к Стилю. Это стандартный 16 трековый SMF который можно воспроизводить на секвенсере любого инструмента. Для его воспроизведения PSR вместе с его секцией Авто аккомпанемента уже не нужны!!! В этом есть свои достоинства но это и есть принципиальным отличием такого файла от всего о чем мы говорили выше см.3.1.- 3.2.
Выше мы рассматривали МИДИ команды с помощью которых из SMF происходит управление работой <Style Player-а> в режиме Real Time. Стилевые треки каждый раз исполнялись «в живую» только вместо исполнителя команды задавались с помощью записанных в трек MIDI Messages. В таком файле нет записи ни одной ноты из стилевых партитур! О том как создать его средствами одного только PSR-а, и о том какие у него преимущества по сравнению с SMF EXPAND Style Tracks читай ниже.
##### 3.3.2. 
Найдите в Руководстве на Ваш PSR в разделе <Song Creator> (или у Вас это может быть чуть под другим названием) что то на подобие <Step Record Chord end Sections Control>. Cоздайте NewSong. Следуя инструкциям, зайдите в Song Creator: NewSong/CHD/ в котором Вам будет предложен стартовый трафарет для записи Song с использованием Стиля. Заполните на свое усмотрение все 14 строчек с стартовыми настройками для выбранного Вами стиля, перейдите в окно STEP REC и запишите свою последовательность аккордов и команд переключения секций стиля для Вашего NewSong.
Выйдите из режима StepRec и не выходя из вкладки CHD, вернитесь к началу и прослушайте работу стиля по записанным Вами командам (подробнее см. Руководство).
Важно: запись в таком виде можно прослушать только в режиме вкладки CHD.
##### 3.3.3. 
Сохраните Вашу запись (присвоив SMF Имя) предварительно выполнив операцию EXPAND как того требует Руководство. Теперь этот файл можно слушать на любом секвенсере в том числе и на PSR Song Player. Это то о чем мы говорили в 3.3.1. Так учит делать Руководство но сама Yamaha в своих демо файлах с использованием стиля так не делает!
##### 3.3.4. 
Откройте этот файл в Song Creator/вкладка 1-16 и посмотрите на содержание CH9-16. Там будет полная нотная партитура всех стилевых партий и в начале каждого трека комплект стандарных канальных настроек для синтезатора исполняющего эту партию.
##### 3.3.5. 
Перейдите на вкладку SYS/EX. Там кроме стандартных для PSR NewSong шести стартовых сообщений появилась еще и куча XGPrm настроек для Style MultiPart. Если покопаться по-внимательней, то там можно найти все SysEx и Yamaha XF Meta сообщения по управлению Стилем которые мы разбирали выше.
##### 3.3.6. 
Эксклюзивный способ от PetrowichPSR!
На всякий случай - сделайте еще одну копию созданного файла.
А вот теперь началось!
Сотрите (удалите) все полностью данные на треках 9-16. Для этого зайдите на вкладку CHANNEL/2 DELETE/ выбирая по очереди Chanel 9-16 удалите все содержимое и сохраните файл с новым именем. 
##### 3.3.7. 
В этом файле остались только SysEx и Meta Event. Среди них есть много «лишних» их то же можно будет аккуратно, внимательно удалять, но главное, что бы там остались те, что мы изучили, т.е. те, что "на-живо" умеют управлять Авто аккомпанементом. Вы их уже знаете. Не уверен – не удаляй!!!
##### 3.3.8. 
Если такой файл загружать в PSR SONG Player и нажимать SONG START он будет управлять стилем, но в нем не записана команда START Style. Как с этим бороться мы уже рассматривали в предыдущей главе.
#### 3.4. Теперь не много о преимуществах и недостатках такого файла.
##### 3.4.1. Преимущества.
В файле есть SysEx привязка к стилю, которым он изначально записан, но если перед стартом (или в процессе воспроизведения) выбрать/переключиться кнопками на другой стиль все будет исполнено новым стилем. Очень удобная функция на стадии выбора аранжировки для Сонга.
По аккордам (XF Meta Events), записанным в этом файле, можно включать для партии Правой руки VOISE EFFECT HARMONY и автоматическое многоголосие будет играть «правильными интервалами». 
Эти же аккорды будут правильно управлять многоголосием вокальных партий микрофона. 
Эти же аккорды будут управлять гармонией фраз под 4 кнопками Multi Part.
Не поленитесь разобрать гармоническую последовательность обычного МИДИ SMF файла (попросите помощь друга) и введите в файл правильные XF акккорды в правильных тактовых позициях. Вы получите возможность пользоваться всеми доп функциями из раздела 3.4.1.
##### 3.4.2. Недостатки.
Файл требует наличия в инструменте «родного стиля» - при воспроизведении на другом инструменте может потребоваться коррекция настроек под другой стиль.
При воспроизведении другим стилем, есть ограничения : новый стиль должен быть в том же размере такта что и оригинальный т.е. 4/4 и ¾ не совместимая замена.
#### 3.5. МИДИ управление настройками MULTI PART синтезаторов.
Когда мы говорим о МИДИ управлении параметрами MULTI PART синтезаторов (их у нас 32) то речь идет всего лишь о том, как изменить содержание (записать свои цифры) в нужных ячейках памяти < MIDI Parameter Change table (MULTI PART)>. 
Напоминаю, что это унифицированная, стандартная таблица распределения Оперативной памяти для всех Yamaha инструментов поддерживающих XG стандарт. Для «общения» с этой памятью был разработан специальный формат МИДИ сообщений Yamaha XG SysEx. Среди них мы чаще всего будем видеть и использовать команду – «Изменить XG Параметр по адресу ( hh mm ll )». 
В оригинале (в SMF файле) она пишется
как F0 43 10 4C hh mm ll dd…F7. 
На дисплей PSR-а/ вкладка SYS/EX она выводится
как XGPrm hh mm ll dd…F7.
Т.е. первые 4 байта F0 43 10 4C (всегда одинаковые) опускаются. По 3-х байтовому адресу, (hh mm ll) сверившись с таблицей, можно понять о каком параметре, какого блока идет речь в сообщении.
Поскольку XG стандарт это расширение GM то, для управления параметрами MULTI PART синтезаторов конечно же можно использовать и стандартные MIDI Chanel Message.
По умолчанию, 
Part номер mm в SysEx команде XGPrm hh mm ll dd…F7
и номер МИДИ канала в MIDI Chanel Message совпадают ( и могут быть в интервале 00-0F). Оба типа сообщений работают одинаково т.е. в конечном результате меняют одну и туже цифру по одному и тому же адресу. Однако у стандартных MIDI Chanel Message в сравнении с SysEx XGPrm доступ естественно более ограничен.
В <USER> настройках <MIDI Receive Setap> PSR-а можно настраивать доступ с помощью Канальных и/или SysEx MIDI сообщений к любой из <PART> инструмента. Среди перечня <PART> здесь есть известные-понятные и есть <PART> не с очень интуитивными названиями. Разрешенный Уровень MIDI Доступа и возможные варианты назначения PART на канал внешнего МИДИ управления <CH No> подробно см. панель управления PSR/ кнопки FUNCTION/MIDI/USER/EDIT/MIDI RECEIVE/CH1 PART=
OFF/
SONG/
MAIN/LAYER/LEFT/
KEYBOARD/
ACMP RHYTHM 1/ACMP RHYTHM 2/ACMP BASS/ACMP CHORD 1/
ACMP CHORD 2/ ACMP PAD/ACMP PHRASE 1/ ACMP PHRASE 2/
EXTRA PART 1/ EXTRA PART 2/ EXTRA PART 3/ EXTRA PART 4/ EXTRA PART 5/ 
Для каждого типа PART Ямаха установила свой набор параметров, доступный для редактирования через MIDI Message. Cамые большие возможности для управления по МИДИ у <PART=SONG>. Это Партии синтезаторов занятых на работе в <PSR Song Player>-е. Только к ним, через <MIDI INPUT> могут добраться (и «на живо» могут быть записаны в Сонг-трек ) сообщения о нотной партитуре <NoteMessage>. Только для <SONG PART> доступно SysEx XG назначение <Rcv MIDI Chanel>.
Более ограничены для внешнего MIDI управления Панельные партитуры <Panel Part> MAIN LAYER LEFT (R1 R2 R3 L) и Стилевые <ACMP> (Style) PART. Подробнее о том, что способны принимать по МИДИ разные <PART> инструмента см. в табл. MIDI PARAMETER CHANGE TABL/MIDI Reception (effective or not for each part).
Среди необычных и интересных, с точки зрения MIDI доступа к внешнему управлению работой PSR-а, я бы выделил <MIDI Receive Setup> для PART с именем <KEYBOARD>. 
Эта <Part> вообще не реагирует на SysEx Messages – только на Канальные сообщения. Но оказывается - ей это и не нужно!!! У нее другое великолепное свойство! Что бы это услышать и оценить сделайте следующие настройки:
1. В PSR в MIDI Receive Setup на CH-1 назначить PART с именем < KEYBOARD>.
2. К <MIDI INPUT> инструмента подключите внешнюю МИДИ клавиатуру (EXTERNAL KEYBOARD) которая будет настроена на передачу по MIDI на МИДИ канале№1 <Transmit CH1>.
Попробуйте играть на внешней клавиатуре Двумя руками - она ведет себя точно так, как встроенная клавиатура Вашего PSR-а с учетом всех настроек родной клавиатуры на PSR. 
Т.е. на ней уже работает режим деления клавиатуры Panel Part MAIN LAYER LEFT, левая рука управляет аккордами, с учетом точки деления клавиатуры и заданного режима апликатуры, работают контроллеры внешней клавиатуры Pitch Bend, Modulation и т.д. Происходит полная подмена родной клавиатуры – точнее обе клавиатуры работают одновременно по одним настройкам! Становится понятным название PART «KEYBOARD». 
Это еще один способ задавать аккорды ( и не только) для ACMP с внешней клавиатуры с помощью MIDI. При этом Вам достаточно сделать единственную дополнительную настройку в PSR <MIDI Receive Setup> USER.

#### 3.4. МИДИ управление настройками других блоков Вашего инструмента

##### 3.4.1. Куда можем залезть - да везде куда пускают!

Когда мы говорили о МИДИ управлении параметрами MULTI PART синтезаторов то, речь шла о том какими способами изменить содержание (записать свои цифры) в нужных ячейках памяти < MIDI Parameter Change table> раздел (MULTI PART). Но если посмотреть повнимательней то, в этой таблице есть еще много разделов памяти, отведенных для хранения, и редактирования параметров настройки других блоков инструмента.
С помощью SysEx F0 43 10 4C hh mm ll dd…F7 можно менять содержимое любой ячейки памяти, адрес которой указан
в < MIDI Parameter Change table>, а значит и управлять их настройками.
На дисплей PSR-а/ на вкладке SYS/EX она (команда) выводится как XGPrm hh mm ll dd…F7.
Стандартное распределение адресов (hh mm ll) по блокам приведено в таблице.
Для
<EFFECT 1>REVERB выделены адреса с 02 01 00 до 02 01 15
Для
<EFFECT 1> CHORUS выделены адреса с 02 01 20 до 02 01 35
Для
<DSP 1> VARIATION выделены адреса с 02 01 40 до 02 01 75
Для
<MULTI EQ> выделены адреса с 02 40 00 до 02 40 14
Для
<EFFECT 2> DSP2-3-4-5-6 адреса с 03 rr 00 до 03 rr 42
………………………………………………………………………………………….
Для <Multi Part> выделены адреса с 08 nn 00 до 08 nn 7F где nn = PART NUMBER. 
Для <DRUM SETUP> выделены адреса с 3n 0D 00 до 3n 5B 2D.
Посмотрите свою Data List – там наверняка будут еще страницы с адресами памяти для редактируемых XGParameters всех доступных устройств в Вашем PSR. Как с ними работать? Да точно так же как и с Multi Part !
По-моему, это супер правильный подход - для всего что доступно для редактирования, вне зависимости это синтезаторы звукового модуля, плагины эффектов, АЦП конверторы и прочая начинка PSR-а, выделены блоки памяти с одинаковым, универсальным, единым способом управления данными -это Yamha XG формат!!!
Вы уже достаточно много узнали о своем инструменте. Если дочитали до этого места и собираетесь читать дальше - пора менять статус!
Попробуйте примерить на себя следующий абзац:
«Знаю адрес, знаю цифру которую туда нужно записать, знаю (где подсмотреть) как выглядит МИДИ команда которая может это сделать. Может быть даже сам смогу это сделать!» 
Если 3 из 4-х «ДА!» тогда можете примерить футболку с надписью
Я уже не «чайник» Я - ПРОДВИНУТЫЙ ПОЛЬЗОВАТЕЛЬ !!!

##### 3.4.2. Как реально этим пользоваться/  я имею  ввиду тем что было написано выше.

На самом деле, имея хороший PSR, никто по-байтово не вписывает МИДИ сообщения в файл.  Да собственно PSR и не
умеет это делать.   Удобнее всего  это делать так.

1.Когда Вы редактируете «чужой» Song под Ваш инструмент, Вы открываете MIXING CONSOLE(SONG CH1-16) и начинаете крутить все ручки во всех вкладках, пробуете менять (на свои) записанные там Volum/Voice/Filter/Tune/Effect и т.п. пока не получим желаемый результат звучания всех (уже написанных) Song партий.
2. Закончив переборы безконечных вариантов,  нужно записать все Ваши изменения в голове редактируемого Song файла. Вот тут Yamaha предлагает свою помощь – как сделать это все (записать все изменения по всем трекам  в голову файла) в один прием. Правда,  в руководствах об такой прекрасной возможности пишется очень вскользь и на мой взгляд не очень понятно, поэтому позволю себе  расписать подробнее.
ВАЖНО!!! Убедитесь, что Вы находитесь в самом начале файла локация BAR 001  BEAT 1.
3. Закройте < MIXING CONSOLE> и откройте   Ваш файл в SONG CREATOR вкладка /SHANELL/5 SET UP/.  
4. Внизу в окошке <SELECT> нужно поставить галочки (MARK ON/OFF) возле тех групп параметров которые Вы меняли и хотели бы сохранить в голове  редактируемого SONG.
Попутно можно записать в сонг еще одну полезную команду!
1. Там есть одна очень  интересная  «фишка» - это уникальная галочка возле  «KEYBOARD VOICE».  Она позволяет:  кроме собственных настроек  сонговых  партитур,  записать дополнительно в Song файл еще и  настройки панельных голосов MAIN/ LEYER/ LEFT которые были в инструменте на тот момент.  При воспроизведении файла,  эти KEYBOARD Voices с своими настройками,   будут автоматически, в заданном такте, загружаться для «живого доигрывания». Это единственная «галочка» которая активна и посреди песни, позволяя вписывать сообщение  KEYBOARD VOICE в нескольких  разных позициях (тактах). Это Meta-сообщение имеет очень большой (до 400 байт) размер и требует некоторой «осторожности» при записи не в начале файла. Это очень удобная,  но не стандартная команда и она не обязательна для исполнения на другом инструменте.  Если все нужные галочки расставлены - идем дальше.
5. Нажмите EXECUTE и затем SAVE и сохраните Ваш отредактированный Song файл.
Можете прослушать его и просмотреть содержимое вкладок SONG CREATOR  /1-16/  и  вкладки SYS/EX.  Там все Ваши  изменения уже должны быть записаны в «голове файла» в виде готовых новых Стандартных канальных и SysEx XGPrm messages.
6.Если Вы хотите записать в файл команду <Вкл. (заданный с настройками  эффектов) KEYBOARD VOICE для панельных партии MAIN>  не в голове файла, а в такте № 24, то для этого нужно:
6.1.Зайти в SONG CREATOR/SHANELL/5 SET UP/.
6.2.Перемотать Кнопкой  Вперед >>  в SONG Player-e такты на <SONG POSITION> 024 BAR.
При этом в окошке SELECT (где галочки) останется активным только один параметр «KEYBOARD VOICE»  (все остальные  будут не доступны,  их можно записывать только в голове файла т.е. в Position 001).
6.3.Поставьте у «KEYBOARD VOICE» галочку <MARK ON>.
6.4.Перейдите в MIXING CONSOLE(PANEL PART)
6.5.Задайте настройки для VOICE MAIN ( можно одновременно и для LAYER и LEFT) всеми доступными кнопками и ручками микшера, проверяя результат звучание на клавиатуре.
6.6.Вернитесь в экран <SONG CREATOR> для чего  нажать кнопку <EXIT>.
6.7.Убедитесь, что Вы по-прежнему в позиции такт 024. Нажмите EXECUTE,  затем SAVE и сохраните Ваш отредактированный Song файл.
Теперь в 24-м такте,  на экране <SONG CREATOR> в вкладке SYS/EX появится новое, самое длинное из мне известных Yamaha Meta Event сообщение типа FF 7F 43 73 0D 00 53 4F ….и т.д. ……за пределы экрана (до 400 байт).
Для Вашего PSR это может выглядеть как FF 7F 43 73 0D 01….. или  еще чуть др.
В результате,  в 24-м такте, на панели управления,  для партии MAIN (а если нужно то и для LAYER и  LEFT)  будет сам включаться записанный VOICE с полным комплектом собственных ( если Вы их меняли, не пресетных!!!) настроек и эффектов.  Не правда ли – приятная функция!
Не отвлекайся на переключения!  Играй поверх МИДИ файла (если умеешь)!
Немного раньше, в главе 3.3.7. я писал, что в созданном Вами по методу PetrowichPSR  файле ( где мы вытерли стилевые треки) осталось еще много не нужных  SysEx которые можно аккуратно подчистить.
Теперь Попробуйте  сами: Загрузите в Ваш плеер  SMF файл созданный Вами в п. 3.3.7.  Откройте вкладку SYS/EX файла.  Глядя (надеюсь уже с некоторым пониманием и гордостью!) на пачки SysEx  типа   XGPrm hh mm ll dd…F7    Постарайтесь разобраться   (ориентируясь,  по таблице,  три байта адреса hh mm ll) о каких настройках идет речь, и  попробуйте выбросить (удалить) заведомо лишние.  Их там намного больше чем необходимых!  Оставляем  те,  что важны для  управления стилем,  ну и конечно те, что имеют отношения  к  трекам 1-8  дописанным вручную  поверх стиля  (если конечно Вы их дописывали?!).   
Последние 7 замечаний относительно файла, созданного таким способом:
1. Ваш <SMF PetrowichPSR>  файл имеет Song треки  1-8.
Их общая громкость регулируется фейдером  <SONG BALANCE>  а по-канальные настройки  при воспроизведении регулируются микшером <MIXING CONSOLE (SONG 1-8)>.
2. Общая громкость партий Стиля (стиль работает вживую, по прописанным аккордам) регулируется  фейдером <STYLE BALANCE> а по-канальные настройки партий Стиля при воспроизведении регулируются микшером <MIXING CONSOLE (STYLE PART)>.
3. В таком файле, изначально    треки 9-16  пустые (без нот),  но парт- синтезаторы 9-16  заняты «живой работой» в стилевом секвенсоре. По этому   Ваши собственные партитуры   если они были добавлены еще и на треки 9-16,  будут «вытеснены» стилем.  Партитуры стиля здесь  имеют приоритет!
4. Если в Song-е не прописана команда STYLE START <F0 43 60 7A F7> (а ее можно дописывать только на внешнем секвенсоре !!!) есть два варианта ручного старта:
№1  Стартуем одновременно двумя кнопками <SONG START + STYLE START>.  
№2  а) В Song Player включаем режим  <SYNC START>. Для этого нажать одновременно  2 кнопки  <TOP+START/STOP>. Кнопка START/STOP начинает моргать, это режим ожидания синхронного пуска.  
б) Производим Синхронный Старт 2-х плееров нажав ОДНУ кнопку <START/STOP> в секции STYLE CONTROLE.
5. Если при воспроизведении не включать   стиль (или выключить его кнопкой STYLE STOP)  то зазвучат (если была запись) и Song треки 9-16.  Если   не было удаления  (см. выше 3.3.6.) то это будут звучать  развернутые EXPAND Стилевые треки записанного оригинального стиля. Если производилось удаление, а на их место были записаны собственные партии,  то будут звучать они. Записанные Song part 9-16 будут звучать до тех пор,  пока их не «вытеснит»  включенный МИДИ командой или кнопкой  «STYLE START» стиль, который в данный момент загружен в стилевой плейер. И это не обязательно тот же стиль что был на записи!  Таким образом, Вы можете мгновенно сравнивать звучание файла с EXPAND (развернутым по трекам) записанным  стилем  и любым другим стилем включаемым «вживую». При этом в самой оригинальной записи ничего не меняется.
6. Перед воспроизведением  или в процессе воспроизведения  такого  файла стиль можно многократно менять  на другой,  желательно с таким же размером такта!
7. Такой файл будет играть записанным Вашим пресетным стилем только на Вашем инструменте!
Причина: родной стиль загружается (для «живой игры по прописанным аккордам»)  в Сонг-плеер по SysEx команде из MIDI файла. В этой записанной команде указан внутренний (служебный) номер стиля который ему присвоила Yamaha в Вашем инструменте.  В другой модели PSR такой же стиль будет под другим номером или его вообще может там не быть. Есть 3 выхода из ситуации:
А) На другом инструменте, после загрузки МИДИ файла, вручную вызовите стиль с похожим (близким по категории) названием и слушайте новый вариант аранжировки.
Б) Если другой инструмент поддерживает Ваш стиль-формат Загрузите в чужой инструмент вместе с МИДИ файлом копию Вашего стиля и вручную вызовите его.
У другого  инструмента могут быть проблемы с чужим Стилем – может не оказаться на борту Voices которые использованы в чужом стиле. Потребуется редакция стиля.
В) Если нужно что бы ваш МИДИ файл  играл на любом инструменте то делайте его запись как указано в Руководстве. Как я уже говорил, для воспроизведения такого файла вовсе не нужен будет инструмент с Авто аккомпанементом.

P.S. Стандартные Канальные МИДИ сообщения не имеют доступа к внутренним настройкам  параметров блоков эффектов и других плагинов Вашего PSR-a.  Предвидеть в стандарте - какие параметры и сколькими ручками регулируются в каждом из 3-8шт  Ваших блоков DSP эффектов или эквалайзеров - было не возможно! Тут работают только Yamaha SysEx формата XGPrm F0 43 10 4C hh mm ll dd…F7.

[Продолжение](https://www.facebook.com/PetrowichPSR)
